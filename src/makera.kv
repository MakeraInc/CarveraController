#:kivy 1.11.1
#:import Factory kivy.factory.Factory
#:import tr __main__.tr

<Label>:
    font_name: 'ARIALUNI'

<TextInput>:
    font_name: 'ARIALUNI'
    write_tab: False

<WideProgressBar@BoxLayout>:
    value: 0
    color: 52/255, 166/255, 208/255, 1
    canvas:
        Color:
            rgba: 50/255, 50/255, 50/255, 1
        Rectangle:
            pos: self.pos
            size: self.width - dp(5) if self.width > 0 else 0, self.height if self.width > 0 else 0
        Color:
            rgba: self.color
        Rectangle:
            pos: self.pos
            size: (self.width - dp(5)) * (self.value / 100.0) + 5 if self.width > 0 else 0, self.height if self.width > 0 else 0

<MCQCheckBox@CheckBox>:
    color: 255, 255, 255, 1
    size_hint: 0.15, 1

<MCQLabel@ButtonBehavior+Label>:
    text_size: self.size
    valign: 'center'
    font_size: '13sp'

<CNCWorkspace>:
    size_hint_x: None
    size_hint_y: None
    width: self.parent.width if self.parent.width > 0 and self.parent.height / self.parent.width > 0.7 else self.parent.height / 0.7
    height: self.parent.height if self.parent.width > 0 and self.parent.height / self.parent.width < 0.7 else self.parent.width * 0.7

<IconButton>:
    width: '50dp'
    icon: ''
    icon_size: 32
    text: ''
    size_hint_x: None
    notify: False
    canvas.before:
        Color:
            rgba: 80/255, 80/255, 80/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        text: root.text if root.text else ''
        canvas.before:
            Color:
                rgba: (110/255, 110/255, 110/255, 1) if root.disabled else (250/255, 250/255, 250/255, 1)
            Rectangle:
                source: root.icon
                pos: self.center_x - dp(root.icon_size / 2), self.center_y - dp(root.icon_size / 2)
                size: dp(root.icon_size) if root.icon else 0, dp(root.icon_size) if root.icon else 0
            Color:
                rgba: 52/255, 152/255, 219/255, 1
            Ellipse:
                pos: self.center_x + dp(12), self.center_y + dp(10)
                size: dp(10) if root.notify else 0, dp(10) if root.notify else 0

<TransparentButton>:
    height: '32dp'
    width: '60dp'
    icon_size: 24
    icon: ''
    text: ''
    min_icon: ''
    min_icon_size: 12
    min_active: True
    active: False
    size_hint_x: None
    background_color: 0, 0, 0, 0
    Label:
        text: root.text if root.text else ''
        color: (0/255, 255/255, 255/255, 1) if (root.active and not root.disabled) else ((110/255, 110/255, 110/255, 1) if root.disabled else (250/255, 250/255, 250/255, 1))
        canvas.before:
            Color:
                rgba: (0/255, 255/255, 255/255, 1) if (root.active and not root.disabled) else ((110/255, 110/255, 110/255, 1) if root.disabled else (250/255, 250/255, 250/255, 1))
            Rectangle:
                source: root.icon
                pos: self.center_x - dp(root.icon_size / 2), self.center_y - dp(root.icon_size / 2)
                size: dp(root.icon_size) if root.icon else 0, dp(root.icon_size) if root.icon else 0
            Color:
                rgba: (250/255, 250/255, 250/255, 1) if root.min_active else (60/255, 60/255, 60/255, 1)
            Rectangle:
                source: root.min_icon if root.min_icon and not root.disabled else ''
                pos: self.x + self.width - dp(root.min_icon_size - 5), self.y + dp(root.min_icon_size / 2)
                size: dp(root.min_icon_size) if root.min_icon and not root.disabled else 0, dp(root.min_icon_size) if root.min_icon and not root.disabled else 0

<TransparentGrayButton>:
    height: '32dp'
    width: '60dp'
    icon_size: 24
    icon: ''
    active: True
    size_hint_x: None
    background_color: 0, 0, 0, 0
    Label:
        canvas.before:
            Color:
                rgba: (250/255, 250/255, 250/255, 1) if root.active and not root.disabled else (100/255, 100/255, 100/255, 1)
            Rectangle:
                source: root.icon
                pos: self.center_x - dp(root.icon_size / 2), self.center_y - dp(root.icon_size / 2)
                size: dp(root.icon_size) if root.icon else 0, dp(root.icon_size) if root.icon else 0

<WiFiButton>:
    orientation: 'horizontal'
    size_hint_y: None
    height: '35dp'
    color: 240/255, 240/255, 240/255, 1
    canvas.before:
        Color:
            rgba: 80/255, 80/255, 80/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        size_hint_x: None
        width: '30dp'
        canvas.before:
            Color:
                rgba: root.color
            Rectangle:
                source: 'data/connected.png'
                pos: self.center_x - dp(24), self.center_y - dp(24)
                size: dp(48) if root.connected else 0, dp(48) if root.connected else 0
    Label:
        text: root.ssid
        text_size: self.size
        halign: 'left'
        valign: 'middle'
        color: root.color
    Label:
        size_hint_x: None
        width: '30dp'
        canvas.before:
            Color:
                rgba: root.color
            Rectangle:
                source: 'data/encrypted.png'
                pos: self.center_x - dp(16), self.center_y - dp(16)
                size: dp(32) if root.encrypted else 0, dp(32) if root.encrypted else 0
    Label:
        size_hint_x: None
        width: '40dp'
        canvas.before:
            Color:
                rgba: root.color
            Rectangle:
                source: 'data/WIFI.png'
                pos: self.center_x - dp(16), self.center_y - dp(16)
                size: dp(32) if root.strength < 1000 else 0, dp(32) if root.strength < 1000 else 0

<ButtonLabel@ButtonBehavior+Label>:
    valign: 'center'

<Row@SelectableLabel>:
    canvas.before:
        Color:
            rgba: (80/255, 80/255, 80/255, 1) if self.selected else (50/255, 50/255, 50/255, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    text_size: self.size
    halign: 'left'
    shorten: True

<DataRow@SelectableBoxLayout>:
    canvas.before:
        Color:
            rgba: (76/255, 76/255, 76/255, 1) if self.selected else (56/255, 56/255, 56/255, 1) if self.rv_key is not None and self.rv_key % 2 == 0 else (48/255, 48/255, 48/255, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    pos: self.pos
    size: self.size
    rv_key: 0
    filename: 'filename'
    filesize: ''
    filedate: ''
    is_dir: False
    Label:
        size_hint_x: None
        width: '30dp'
        background_color: 0,0,0,0
        text: ''
        canvas.before:
            Color:
                rgba: (250/255, 250/255, 250/255, 1)
            Rectangle:
                source: 'data/folder-32.png' if root.is_dir else 'data/file-32.png'
                pos: self.center_x - dp(10), self.center_y - dp(10)
                size: dp(20), dp(20)
    Label:
        id: id_label1
        text_size: self.size
        text: root.filename
        halign: 'left'
        valign: 'middle'
    Label:
        id: id_label2
        text_size: self.size
        text: root.filedate
        halign: 'left'
        size_hint_x: None
        width: '150dp'
        valign: 'middle'
    Label:
        id: id_label3
        text_size: self.size
        text: root.filesize
        halign: 'right'
        size_hint_x: None
        width: '100dp'
        valign: 'middle'

<GridBoxLayout@BoxLayout>:
    orientation: 'vertical'
    padding: '5dp'

<RoundButton@Button>:
    background_color: 0,0,0,0  # the last zero is the critical on, make invisible
    canvas.before:
        Color:
            rgba: (88/255,88/255,88/255,1) if self.state=='normal' else (50/255,164/255,206/255,1)  # visual feedback of press
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(25),]


<SmallRoundButton@Button>:
    background_color: 0,0,0,0  # the last zero is the critical on, make invisible
    size_hint_y: None
    height: '35dp'
    canvas.before:
        Color:
            rgba: (88/255,88/255,88/255,1) if self.state=='normal' else (50/255,164/255,206/255,1)  # visual feedback of press
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10),]

<DropDownHint>:
    size_hint_y: None
    height: '20dp'
    font_size: '13sp'
    text_size: self.size
    valign: 'middle'
    halign: 'center'
    color: 150/255, 150/255, 150/255, 1

<DropDownSplitter>:
    size_hint_y: None
    height: '20dp'
    font_size: '13sp'
    text_size: self.size
    valign: 'middle'
    color: 150/255, 150/255, 150/255, 1
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size

<StatusContent@BoxLayout>:
    size_hint_y: None
    height: '20dp'
    orientation: 'horizontal'
    title: ''
    value: ''
    color: 220 / 255, 220 / 255, 220 / 255, 1
    default_color: 220 / 255, 220 / 255, 220 / 255, 1
    Label:
        height: '20dp'
        font_size: '13sp'
        text_size: self.size
        valign: 'middle'
        halign: 'right'
        text: root.title
    Label:
        height: '20dp'
        font_size: '13sp'
        text_size: self.size
        valign: 'middle'
        halign: 'right'
        text: root.value
        color: root.color
    Widget:
        size_hint_x: None
        width: '5dp'

<XDropDown>:
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    DropDownHint:
        text: tr._('Set X Origin')
    TooltipButton:
        text: tr._('X = 0')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Set the current position as the work origin of X")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.wcsSet(0, None, None, None)
    TooltipButton:
        text: tr._('Set X')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Specify the current position as the working coordinate value of X")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.coord_popup.setx_popup.open()

<YDropDown>:
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    DropDownHint:
        text: tr._('Set Y Origin')
    TooltipButton:
        text: tr._('Y = 0')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Set the current position as the work origin of Y")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.wcsSet(None, 0, None, None)
    TooltipButton:
        text: tr._('Set Y')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Specify the current position as the working coordinate value of Y")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.coord_popup.sety_popup.open()

<ZDropDown>:
    status_max: status_max
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    DropDownHint:
        text: tr._('Set Z Origin')
    TooltipButton:
        text: tr._('Z = 0')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Set the current position as the work origin of Z")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.wcsSet(None, None, 0, None)
    TooltipButton:
        text: tr._('Set Z')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Specify the current position as the working coordinate value of Z")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.coord_popup.setz_popup.open()
    DropDownHint:
        text: tr._('Auto Leveling')
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: '23dp'
        padding: '0.5dp'
        canvas.before:
            Color:
                rgba: 80/255, 80/255, 80/255, 1
            Rectangle:
                pos: self.pos
                size: self.size
        StatusContent:
            id: status_max
            title: tr._('max:')
            value: '0.000'
            color: (231/255, 76/255, 60/255, 1) if self.value != '0.000' else self.default_color
    TooltipButton:
        text: tr._('Clear')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        tooltip_text: tr._("Clear the data for auto leveling")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.clearAutoLeveling()


<ADropDown>:
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    DropDownHint:
        text: tr._('Set A Origin')
    TooltipButton:
        text: tr._('A = 0')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Set the current position as the work origin of A")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.wcsSet(None, None, None, 0)
    TooltipButton:
        text: tr._('Set A')
        size_hint_y: None
        height: '48dp'
        font_size: '20sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Specify the current position as the working coordinate value of A")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.coord_popup.seta_popup.open()
    TooltipButton:
        text: tr._('Shrink')
        size_hint_y: None
        height: '48dp'
        font_size: '16sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Shrink the mechanical coordinates based on the remainder of 360")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.shrinkA()
    TooltipButton:
        text: tr._('Fast Move')
        size_hint_y: None
        height: '48dp'
        font_size: '16sp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Fastly move the work coordinates to the specified value")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.coord_popup.MoveA_popup.open()


<FeedDropDown>:
    scale_slider: scale_slider
    status_scale: status_scale
    status_target: status_target
    disabled: app.state != 'Idle' and app.state != 'Run'
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    DropDownHint:
        text: tr._('Feed Status')
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: '40dp'
        padding: '0.5dp'
        canvas.before:
            Color:
                rgba: 80/255, 80/255, 80/255, 1
            Rectangle:
                pos: self.pos
                size: self.size
        StatusContent:
            id: status_scale
            title: tr._('Scale:')
            value: '100%'
            color: (231/255, 76/255, 60/255, 1) if self.value != '100%' else self.default_color
        StatusContent:
            id: status_target
            title: tr._('Target:')
            value: '1000'

    DropDownHint:
        text: tr._('Speed Scaling')
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: None
        height: '40dp'
        padding: '0.5dp'
        Slider:
            canvas.before:
                Color:
                    rgba: 80/255, 80/255, 80/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: scale_slider
            min: 50
            max: 200
            value: 100
            step: 10
            set_flag: False
            on_value:
                if self.set_flag: self.set_flag = False
                else: app.root.update_control('feedrate_scale', self.value)
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: None
        height: '40dp'
        Button:
            text: '-'
            font_size: '25sp'
            on_release:
                if root.scale_slider.value >= 60: root.scale_slider.value = root.scale_slider.value - 10
        Button:
            text: '+'
            font_size: '25sp'
            on_release:
                if root.scale_slider.value <= 190: root.scale_slider.value = root.scale_slider.value + 10
    TooltipButton:
        text: tr._('Reset')
        size_hint_y: None
        height: '40dp'
        font_size: '15sp'
        tooltip_text: tr._("Reset the feed speed scaling value to 100%")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.scale_slider.value = 100
            root.select('Third Item')

<SpindleDropDown>:
    vacuum_switch: vacuum_switch
    autoextout_switch:autoextout_switch
    scale_slider: scale_slider
    status_scale: status_scale
    status_target: status_target
    status_temp: status_temp
    disabled: app.state != 'Idle' and app.state != 'Run'
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    DropDownHint:
        text: tr._('Spindle Status')
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: '60dp'
        padding: '0.5dp'
        canvas.before:
            Color:
                rgba: 80/255, 80/255, 80/255, 1
            Rectangle:
                pos: self.pos
                size: self.size
        StatusContent:
            id: status_scale
            title: tr._('Scale:')
            value: '100 %'
        StatusContent:
            id: status_target
            title: tr._('Target:')
            value: '1000'
        StatusContent:
            id: status_temp
            title: tr._('Temp:')
            value: '10 C'
    DropDownHint:
        text: tr._('Auto Vacuum')
        size_hint_y: None
        opacity: 1 if app.model == 'C1' else 0
        height: 0 if not app.model == 'C1' else '20dp'
    BoxLayout:
        padding: '0.5dp'
        size_hint_y: None
        opacity: 1 if app.model == 'C1' else 0
        height: 0 if not app.model == 'C1' else '40dp'
        Switch:
            id: vacuum_switch
            canvas.before:
                Color:
                    rgba: 50/255, 50/255, 50/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            set_flag: False
            on_active:
                if self.set_flag: self.set_flag = False
                else: app.root.update_control('vacuum_mode', self.active)
    DropDownHint:
        text: tr._('Auto ExtOut')
    BoxLayout:
        padding: '0.5dp'
        size_hint_y: None
        opacity: 1
        height: '40dp'
        Switch:
            id: autoextout_switch
            canvas.before:
                Color:
                    rgba: 50/255, 50/255, 50/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            set_flag: False
            on_active:
                if self.set_flag: self.set_flag = False
                else: app.root.update_control('extout_mode', self.active)
    DropDownHint:
        text: tr._('RPM Scaling')
    BoxLayout:
        padding: '0.5dp'
        size_hint_y: None
        height: '40dp'
        Slider:
            id: scale_slider
            min: 50
            max: 200
            value: 100
            step: 10
            set_flag: False
            canvas.before:
                Color:
                    rgba: 80/255, 80/255, 80/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            on_value:
                if self.set_flag: self.set_flag = False
                else: app.root.update_control('spindle_scale', self.value)
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: None
        height: '40dp'
        Button:
            text: '-'
            font_size: '25sp'
            on_release:
                if root.scale_slider.value >= 60: root.scale_slider.value = root.scale_slider.value - 10
        Button:
            text: '+'
            font_size: '25sp'
            on_release:
                if root.scale_slider.value <= 190: root.scale_slider.value = root.scale_slider.value + 10
    TooltipButton:
        text: tr._('Reset')
        size_hint_y: None
        height: '40dp'
        font_size: '15sp'
        tooltip_text: tr._("Reset the RPM scaling value to 100%")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.scale_slider.value = 100
            root.select('Third Item')

<ToolDropDown>:
    set_dropdown: set_dropdown
    change_dropdown: change_dropdown
    status_tlo: status_tlo
    status_wpvoltage: status_wpvoltage
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    disabled: app.state != 'Idle' or app.lasering
    DropDownHint:
        text: tr._('Tool Status')
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: '40dp'
        padding: '0.5dp'
        canvas.before:
            Color:
                rgba: 80/255, 80/255, 80/255, 1
            Rectangle:
                pos: self.pos
                size: self.size
        StatusContent:
            id: status_tlo
            title: tr._('TLO:  ')
            value: '0.000'
        StatusContent:
            id: status_wpvoltage
            title: tr._('WP:  ')
            value: '0.00v'
            disabled: app.model != 'C1'

    TooltipSpinner:
        size_hint_y: None
        height: '40dp'
        id: change_dropdown
        text: tr._('Change...')
        tooltip_text: tr._("Change to the selected tool,and auto calibration")
        tooltip_position: 'right'  # 在按钮右侧显示
        values: 'Probe', 'Tool: 1', 'Tool: 2', 'Tool: 3', 'Tool: 4', 'Tool: 5', 'Tool: 6'
        on_text:
            if self.text != tr._("Change...") and self.text != 'Other Tool': app.root.controller.changeToolCommand(self.text[-1])
            if self.text == 'Other Tool': app.root.change_tool_popup.open()
            if self.text != tr._("Change..."): self.text = tr._('Change...')
            root.select('Third Item')
    TooltipButton:
        text: tr._('Calibrate')
        size_hint_y: None
        height: '40dp'
        tooltip_text: tr._("Automatically calibrate the current tool and set TLO")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.calibrateToolCommand()
    TooltipButton:
        text: tr._('Drop')
        size_hint_y: None
        height: '40dp' if app.model == 'C1' else '0dp'
        opacity: 1 if app.model == 'C1' else 0
        tooltip_text: tr._("Drop the current tool")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            root.select('Third Item')
            app.root.controller.dropToolCommand()
    TooltipSpinner:
        size_hint_y: None
        height: '40dp'
        id: set_dropdown
        text: tr._('Set...')
        tooltip_text: tr._("Manually set the current tool number")
        tooltip_position: 'right'  # 在按钮右侧显示
        values: 'Empty', 'Probe', 'Tool: 1', 'Tool: 2', 'Tool: 3', 'Tool: 4', 'Tool: 5', 'Tool: 6'
        on_text:
            if self.text != tr._("Set...") and self.text != 'Other Tool': app.root.controller.setToolCommand(self.text[-1])
            if self.text == 'Other Tool': app.root.set_tool_popup.open()
            if self.text != tr._("Set..."): self.text = tr._('Set...')
            root.select('Third Item')


<ChangeToolPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    txt_offset: txt_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Input Tool Number')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            padding: '15dp'
            orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: 'Value:'
                halign: "left"
                valign: "center"
                text_size: self.size
            TextInput:
                id: txt_offset
                hint_text: tr._('Input Tool Number')
                multiline: False
                text: '1'
                halign: "left"
                input_type: 'number'
                input_filter: 'int'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    if int(txt_offset.text) > 999:\
                    app.root.toolnum_confirm_popup()
                    else:\
                    app.root.controller.changeToolCommand(txt_offset.text)
                    root.dismiss()
<SetToolnumPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    txt_offset: txt_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Input Tool Number')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            padding: '15dp'
            orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: 'Value:'
                halign: "left"
                valign: "center"
                text_size: self.size
            TextInput:
                id: txt_offset
                hint_text: tr._('Input Tool Number')
                multiline: False
                text: '1'
                halign: "left"
                input_type: 'number'
                input_filter: 'int'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    if int(txt_offset.text) > 999:\
                    app.root.toolnum_confirm_popup()
                    else:\
                    app.root.controller.setToolCommand(txt_offset.text);\
                    root.dismiss()


<LaserDropDown>:
    switch: switch
    status_scale: status_scale
    test_switch: test_switch
    scale_slider: scale_slider
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    DropDownHint:
        text: tr._('Laser Status')
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: '23dp'
        padding: '0.5dp'
        canvas.before:
            Color:
                rgba: 80/255, 80/255, 80/255, 1
            Rectangle:
                pos: self.pos
                size: self.size
        StatusContent:
            id: status_scale
            title: tr._('scale:')
            value: '100 %'
    DropDownHint:
        text: tr._('Enable Laser')
    BoxLayout:
        padding: '0.5dp'
        size_hint_y: None
        height: '40dp'
        disabled: app.state != 'Idle'
        Switch:
            id: switch
            canvas.before:
                Color:
                    rgba: 50/255, 50/255, 50/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            set_flag: False
            on_active:
                if self.set_flag: self.set_flag = False
                else: app.root.update_control('laser_mode', self.active)
    BoxLayout:
        id: laser_control
        orientation: 'vertical'
        size_hint_y: None
        height: '200dp'
        DropDownHint:
            text: tr._('Laser Test')
        BoxLayout:
            padding: '0.5dp'
            size_hint_y: None
            height: '40dp'
            disabled: (not app.lasering) or (app.state != 'Idle')
            Switch:
                id: test_switch
                canvas.before:
                    Color:
                        rgba: 50/255, 50/255, 50/255, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                set_flag: False
                on_active:
                    if self.set_flag: self.set_flag = False
                    else: app.root.update_control('laser_test', self.active)
        DropDownHint:
            text: tr._('Power Scaling')
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: '40dp'
            padding: '0.5dp'
            disabled: (not app.lasering) or (app.state != 'Idle' and app.state != 'Run')
            Slider:
                id: scale_slider
                canvas.before:
                    Color:
                        rgba: 80/255, 80/255, 80/255, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                min: 10
                max: 100
                value: 100
                step: 10
                set_flag: False
                on_value:
                    if self.set_flag: self.set_flag = False
                    else: app.root.update_control('laser_scale', self.value)
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: '40dp'
            disabled: (not app.lasering) or (app.state != 'Idle' and app.state != 'Run')
            Button:
                text: '-'
                font_size: '25sp'
                on_release:
                    if root.scale_slider.value >= 20: root.scale_slider.value = root.scale_slider.value - 10
            Button:
                text: '+'
                font_size: '25sp'
                on_release:
                    if root.scale_slider.value <= 90: root.scale_slider.value = root.scale_slider.value + 10
        TooltipButton:
            text: tr._('Reset')
            size_hint_y: None
            height: '40dp'
            font_size: '15sp'
            tooltip_text: tr._("Reset the Laser power scaling value to 100%")
            tooltip_position: 'right'  # 在按钮右侧显示
            disabled: (not app.lasering) or (app.state != 'Idle' and app.state != 'Run')
            on_release:
                root.scale_slider.value = 100
                root.select('Third Item')

<FuncDropDown>:
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    IconButton:
        icon: 'data/file.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        height: '40dp'
        tooltip_text: tr._("Switch to display file preview interface")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            app.root.content.transition.direction = 'right'
            app.root.content.current = 'File'
            root.select('')
    IconButton:
        icon: 'data/move.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        height: '50dp'
        tooltip_text: tr._("Switch to display manual control interface")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            app.root.content.transition.direction = 'left'
            app.root.content.current = 'Control'
            root.select('')
    IconButton:
        icon: 'data/diagnose.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        disabled: app.state == 'N/A'
        height: '50dp'
        tooltip_text: tr._("Device status diagnose")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            root.select('')
            app.root.diagnose_popup.open() if app.model == 'C1' else app.root.diagnose_popup_Air.open()
            #app.root.diagnose_popup.open()
    IconButton:
        icon: 'data/WIFI.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        height: '50dp'
        disabled: app.state != 'Idle'
        tooltip_text: tr._("WiFi configuration")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            app.root.startLoadWiFi(self)
    IconButton:
        icon: 'data/pairing.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        height: '50dp' if app.model == 'C1' else '0dp'
        opacity: 1 if app.model == 'C1' else 0
        disabled: app.state != 'Idle'
        tooltip_text: tr._("Wireless Probe Pairing")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            app.root.pairing_popup.pairing_note = ''
            app.root.pairing_popup.open()
    IconButton:
        icon: 'data/upgrade.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        #notify: (app.fw_has_update or app.ctl_has_update) and app.state != 'N/A'
        #disabled: app.state != 'Idle'
        notify: (app.fw_has_update or app.ctl_has_update)
        height: '50dp'
        tooltip_text: tr._("Software and firmware Upgrade")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            root.select('')
            app.root.open_update_popup()
    IconButton:
        icon: 'data/language.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        height: '50dp'
        tooltip_text: tr._("language selection")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            root.select('')
            app.root.language_popup.open()
    IconButton:
        icon: 'data/configure.png'
        icon_size: 24
        small_icon: True
        size_hint_y: None
        #disabled: app.state != 'Idle'
        height: '50dp'
        tooltip_text: tr._("Parameters settings")
        tooltip_position: 'left'  # 在按钮左侧显示
        on_release:
            root.select('')
            app.root.config_popup.open()

<StatusDropDown>:
    btn_connect_usb: btn_connect_usb
    btn_connect_wifi: btn_connect_wifi
    btn_unlock: btn_unlock
    btn_disconnect: btn_disconnect
    btn_last_connect: btn_last_connect

    auto_width:False
    width:'175dp'
    canvas.before:
        Color:
            rgba: 60/255, 60/255, 60/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    TooltipButton:
        id: btn_last_connect
        size_hint_y: None
        height: '40dp'
        text: tr._('Recent Connection')
        tooltip_text: tr._("Recent connection, click to reconnect")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            app.root.RecentConnection(self)
    TooltipButton:
        id: btn_connect_wifi
        size_hint_y: None
        height: '40dp'
        text: tr._('WIFI...')
        tooltip_text: tr._("Connecting Machine via WiFi")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            app.root.open_wifi_conn_drop_down(self)
    TooltipButton:
        id: btn_connect_usb
        size_hint_y: None
        height: '40dp'
        text: tr._(' USB...')
        tooltip_text: tr._("Connecting Machine via USB")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            app.root.open_comports_drop_down(self)
    TooltipButton:
        id: btn_unlock
        text: tr._('Unlock')
        size_hint_y: None
        height: '40dp'
        disabled: True
        tooltip_text: tr._("Unlock machine")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            if self.text == tr._('Unlock'):\
            app.root.controller.unlock();\
            root.select('')
            else:\
            app.root.controller.reset();\
            root.select('')
    TooltipButton:
        id: btn_disconnect
        text: tr._('Disconnect')
        size_hint_y: None
        height: '40dp'
        disabled: True
        tooltip_text: tr._("Disconnect with the machine")
        tooltip_position: 'right'  # 在按钮右侧显示
        on_release:
            app.root.close()
            root.select('')

<ComPortsDropDown>:

<OperationDropDown>:
    Button:
        text: tr._('Upload...')
        size_hint_y: None
        height: '40dp'
        on_release:
            root.select('')
    Button:
        text: tr._('Download')
        size_hint_y: None
        height: '40dp'
        on_release:
            root.select('')
    Button:
        text: tr._('Delete')
        size_hint_y: None
        height: '40dp'
        on_release:
            root.select('')
    Button:
        text: tr._('Rename')
        size_hint_y: None
        height: '40dp'
        on_release:
            root.select('')

<TopDataView>:
    orientation: 'horizontal'
    size_hint_x: None
    scale: 100
    width: '95dp'
    padding: '3dp'
    active: False
    canvas.before:
        Color:
            rgba: 80/255, 80/255, 80/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    color: 225/255, 225/255, 225/255, 1
    data_text: ''
    data_icon: ''

    main_text: ''
    minr_text: ''
    tooltip_text: ''  # 默认提示文本
    tooltip_position:'bottom'  # 在按钮下方显示


    Label:
        canvas.before:
            Color:
                rgba: (0/255, 255/255, 255/255, 1) if (root.active and not root.disabled) else root.color
            Rectangle:
                source: root.data_icon
                pos: self.center_x - dp(10), self.center_y - dp(14)
                size: dp(28) if root.data_icon else 0, dp(28) if root.data_icon else 0
        text: root.data_text if root.data_text else ''
        size_hint_x: 0.22
        font_size: '23sp'
        color: (0/255, 255/255, 255/255, 1) if root.active else root.color
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: root.main_text
            color: (0/255, 255/255, 255/255, 1) if root.scale != 100 else (225/255, 225/255, 225/255, 1)
            font_size: '18sp'
            text_size: self.size
            halign: "right"
            multiline: False
        Label:
            text: root.minr_text
            color: 160/255, 160/255, 160/255, 1
            font_size: '11sp'
            text_size: self.size
            halign: "right"

<DirectoryView>:
    orientation: 'horizontal'
    selected: False
    data_text: ''
    data_icon: 'data/folder-32.png'
    full_path: ''
    canvas.before:
        Color:
            rgba: 80/255, 80/255, 80/255, 1
        Rectangle:
            pos: self.pos
            size: self.size
    Label:
        canvas.before:
            Color:
                rgba: 225/255, 225/255, 225/255, 1
            Rectangle:
                source: 'data/connected.png'
                pos: self.center_x - dp(10), self.center_y - dp(10)
                size: dp(20) if root.selected else dp(0), dp(20) if root.selected else dp(0)
        text: ''
        size_hint_x: 0.15
    Label:
        canvas.before:
            Color:
                rgba: root.color
            Rectangle:
                source: 'data/folder-32.png' if root.data_icon == '' else root.data_icon
                pos: self.center_x - dp(10), self.center_y - dp(10)
                size: dp(20), dp(20)
        text: ''
        size_hint_x: 0.2
    Label:
        text: root.data_text
        color: 225/255, 225/255, 225/255, 1
        text_size: self.size
        valign: 'middle'
        multiline: False

<LanguagePopup>:
    sp_language: sp_language
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            size_hint_y: 0.4
            text: tr._('Select Language')
            bold: True
        BoxLayout:
            orientation: 'vertical'
            Label:
            Spinner:
                id: sp_language
                text: ''
            Label:
        BoxLayout:
            size_hint_y: 0.4
            Button:
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                text: tr._('Ok')
                on_release:
                    app.root.change_language(sp_language.text)


<InputPopup>:
    lb_title: lb_title
    txt_content: txt_content
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            size_hint_y: 0.4
            id: lb_title
            text: tr._('Input Box')
            bold: True
        BoxLayout:
            orientation: 'vertical'
            Label:
            TextInput:
                id: txt_content
                size_hint_y: None
                height: '35dp'
                multiline: False
                text: ''
            Label:
        BoxLayout:
            size_hint_y: 0.4
            Button:
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                text: tr._('Ok')
                on_release:
                    if root.confirm():\
                    root.dismiss()


<ConfirmPopup>:
    lb_title: lb_title
    lb_content: lb_content
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            size_hint_y: 0.4
            id: lb_title
            text: tr._('Confirm Box')
            bold: True
        Label:
            id: lb_content
            text: tr._('Confirm to continue?')
        BoxLayout:
            size_hint_y: 0.4
            Button:
                text: tr._('Cancel')
                on_release:
                    root.dismiss()
                    if root.cancel:\
                    root.cancel()
            Button:
                text: tr._('Confirm')
                on_release:
                    root.dismiss()
                    root.confirm()
<ToolConfirmPopup>:
    lb_title: lb_title
    lb_content: lb_content
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            size_hint_y: 0.4
            id: lb_title
            text: tr._('Confirm Box')
            bold: True
        Label:
            id: lb_content
            text: tr._('Confirm to continue?')
        BoxLayout:
            size_hint_y: 0.4
            Button:
                text: tr._('Confirm')
                on_release:
                    root.dismiss()
                    root.confirm()
<MessagePopup>:
    btn_ok: btn_ok
    lb_content: lb_content
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            id: lb_content
            text: tr._('Confirm to continue?')
        BoxLayout:
            id: btn_ok
            size_hint_y: 0.4
            Label:
            Button:
                text: tr._('Ok')
                on_release: root.dismiss()
            Label:

<ProgressPopup>:
    progress_bar: progress_bar
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    btn_cancel: btn_cancel
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            id: progress_label
            text: root.progress_text
            halign: 'center'

        ProgressBar:
            id: progress_bar
            max: 100
            value: root.progress_value
        BoxLayout:
            size_hint_y: 0.4
            Label:
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release:
                    root.cancel()
                    self.disabled = True
            Label:


<OriginPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    cbx_anchor1: cbx_anchor1
    cbx_anchor2: cbx_anchor2
    cbx_4axis_origin: cbx_4axis_origin
    cbx_current_position: cbx_current_position
    txt_x_offset: txt_x_offset
    txt_y_offset: txt_y_offset
    TabbedPanel:
        do_default_tab: False
        tab_width: root.width / 2 - dp(2)
        TabbedPanelItem:
            text: tr._('Auto-Set By Offset')
            BoxLayout:
                padding: '15dp'
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: None
                    height: '50dp'

                    MCQCheckBox:
                        id: cbx_anchor1
                        group: 'anchor'
                        active: True
                        disabled: app.has_4axis
                    MCQLabel:
                        on_press: cbx_anchor1._do_press()
                        text: tr._('Anchor1')
                        disabled: app.has_4axis
                    MCQCheckBox:
                        id: cbx_anchor2
                        group: 'anchor'
                        active: False
                        disabled: app.has_4axis
                    MCQLabel:
                        on_press: cbx_anchor2._do_press()
                        text: tr._('Anchor2')
                        disabled: app.has_4axis
                    MCQCheckBox:
                        id: cbx_4axis_origin
                        group: 'anchor'
                        active: False
                        disabled: not app.has_4axis
                    MCQLabel:
                        on_press: cbx_4axis_origin._do_press()
                        text: tr._('4Axis Origin')
                        disabled: not app.has_4axis
                    MCQCheckBox:
                        id: cbx_current_position
                        group: 'anchor'
                        active: False
                        disabled: app.has_4axis
                    MCQLabel:
                        on_press: cbx_current_position._do_press()
                        text: tr._('Current Pos')
                        disabled: app.has_4axis
                    # Label:

                BoxLayout:
                    size_hint_y: None
                    height: '30dp'
                    Label:
                        text: tr._('X Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_x_offset
                        hint_text: tr._('Enter X Offset')
                        multiline: False
                        text: '10'
                        input_type: 'number'
                        input_filter: 'float'
                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Y Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_y_offset
                        hint_text: tr._('Enter Y Offset')
                        multiline: False
                        text: '10'
                        input_type: 'number'
                        input_filter: 'float'
                BoxLayout:
                    id: empty
                    Label:
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        text: tr._('Note: Work origin will be set immediately when clicking OK.')
                        color: 52/255, 152/255, 219/255, 1

                BoxLayout:
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Button:
                        id: btn_cancel
                        text: tr._('Cancel')
                        on_release: root.dismiss()
                    Button:
                        id: btn_ok
                        text: tr._('Ok')
                        on_release:
                            root.coord_popup.set_config('origin', 'anchor', root.selected_anchor())
                            root.coord_popup.set_config('origin', 'x_offset', float(txt_x_offset.text or '10'))
                            root.coord_popup.set_config('origin', 'y_offset', float(txt_y_offset.text or '10'))
                            app.root.set_work_origin()
                            # root.coord_popup.load_origin_label()
                            root.dismiss()

        TabbedPanelItem:
            text: tr._('Set By XYZ Probe')
            BoxLayout:
                padding: '15dp'
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: None
                    height: '25dp'
                BoxLayout:
                    size_hint_y: None
                    height: '30dp'
                    Label:
                        text: tr._('Block Thickness:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_probe_height
                        hint_text: tr._('Height Above Workpiece')
                        multiline: False
                        text: '9'
                        input_type: 'number'
                        input_filter: 'float'
                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Tool Diameter:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_tool_diameter
                        hint_text: tr._('Tool Diameter')
                        multiline: False
                        text: '3.175'
                        input_type: 'number'
                        input_filter: 'float'
                BoxLayout:
                    id: empty
                    Label:
                        text: tr._('Note: Please make sure the probe is stably positioned and the magnet head is attached to the tool.')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        color: 52/255, 152/255, 219/255, 1
                BoxLayout:
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Button:
                        id: btn_cancel
                        text: tr._('Cancel')
                        on_release: root.dismiss()
                    Button:
                        id: btn_ok
                        text: tr._('Ok')
                        on_release:
                            app.root.controller.xyzProbe(float(txt_probe_height.text or '9'), float(txt_tool_diameter.text or '3.175'))
                            root.dismiss()

<ZProbePopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    cbx_origin1: cbx_origin1
    cbx_origin2: cbx_origin2
    txt_x_offset: txt_x_offset
    txt_y_offset: txt_y_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Z Probe Config')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            size_hint_y: None
            height: '50dp'
            MCQCheckBox:
                id: cbx_origin1
                group: 'origin'
            MCQLabel:
                on_press: cbx_origin1._do_press()
                text: tr._('Work Origin')
            MCQCheckBox:
                id: cbx_origin2
                group: 'origin'
            MCQLabel:
                on_press: cbx_origin2._do_press()
                text: tr._('Path Origin')
            Label:
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: tr._('X Offset:')
                halign: "left"
                valign: "middle"
                text_size: self.size
            TextInput:
                id: txt_x_offset
                hint_text: tr._('Enter X Offset')
                multiline: False
                text: '10'
                input_type: 'number'
                input_filter: 'float'
            Label:
                size_hint_x: 0.3
            Label:
                text: tr._('Y Offset:')
                halign: "left"
                valign: "middle"
                text_size: self.size
            TextInput:
                id: txt_y_offset
                hint_text: tr._('Enter Y Offset')
                multiline: False
                text: '10'
                input_type: 'number'
                input_filter: 'float'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    root.coord_popup.set_config('zprobe', 'origin', 1 if cbx_origin1.active else 2)
                    root.coord_popup.set_config('zprobe', 'x_offset', float(txt_x_offset.text or '10'))
                    root.coord_popup.set_config('zprobe', 'y_offset', float(txt_y_offset.text or '10'))
                    root.coord_popup.load_zprobe_label()
                    root.dismiss()

<XYZProbePopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    origin: 0
    txt_probe_height: txt_probe_height
    txt_tool_diameter: txt_tool_diameter
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('XYZ Probe At Current Position')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            size_hint_y: None
            height: '25dp'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: tr._('Block Thickness:')
                halign: "left"
                valign: "middle"
                text_size: self.size
            TextInput:
                id: txt_probe_height
                hint_text: tr._('Height Above Workpiece')
                multiline: False
                text: '9'
                input_type: 'number'
                input_filter: 'float'
            Label:
                size_hint_x: 0.3
            Label:
                text: tr._('Tool Diameter:')
                halign: "left"
                valign: "middle"
                text_size: self.size
            TextInput:
                id: txt_tool_diameter
                hint_text: tr._('Tool Diameter')
                multiline: False
                text: '3.175'
                input_type: 'number'
                input_filter: 'float'
        BoxLayout:
            id: empty
            Label:
                text: tr._('Note: Please make sure the probe is stably positioned and the magnet head is attached to the tool.')
                halign: "left"
                valign: "middle"
                text_size: self.size
                color: 52/255, 152/255, 219/255, 1
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    app.root.controller.xyzProbe(float(txt_probe_height.text or '9'), float(txt_tool_diameter.text or '3.175'))
                    root.dismiss()

<PairingPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    origin: 0
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Paring Wireless Probe')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            size_hint_y: None
            height: '25dp'
        BoxLayout:
            Label:
            Button:
                id: btn_start_pairing
                size_hint_x: None
                width: '200dp'
                size_hint_y: None
                height: '40dp'
                text: str(root.countdown) if root.pairing else tr._('Start Pairing')
                disabled: root.pairing
                on_release:
                    root.start_pairing()
                    app.root.controller.pairWP()
            Label:
        BoxLayout:
            id: empty
            Label:
                text: root.pairing_note
                halign: "center"
                valign: "middle"
                text_size: self.size
                color: 52/255, 152/255, 219/255, 1
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_close
                text: tr._('Close')
                on_release: root.dismiss()

<AutoLevelPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    sp_x_points: sp_x_points
    sp_y_points: sp_y_points
    sp_height: sp_height
    lb_min_x: lb_min_x
    lb_max_x: lb_max_x
    lb_step_x: lb_step_x
    lb_min_y: lb_min_y
    lb_max_y: lb_max_y
    lb_step_y: lb_step_y

    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Auto Leveling Config')
            halign: 'left'
            valign: 'middle'
        Label:
            size_hint_y: None
            height: '10dp'
        GridLayout:
            spacing: '3dp'
            size_hint_y: None
            height: '110dp'
            cols: 5
            rows: 4
            # row1
            Label:
                size_hint_x: 0.2
            Label:
            Label:
                id: lb_height
                text: tr._('Clearance Height:   ')
            Spinner:
                id: sp_height
                text: '5'
                values: '2', '5', '15', '30'
                on_text:
                    root.init()
            Label:
            # row2
            Label:
                size_hint_x: 0.2
            Label:
                text: tr._('Min')
            Label:
                text: tr._('Max')
            Label:
                text: tr._('Step')
            Label:
                text: tr._('Points')
            # row3
            Label:
                text: 'X:'
                size_hint_x: 0.2
            Label:
                id: lb_min_x
                text: '0.0'
            Label:
                id: lb_max_x
                text: '0.0'
            Label:
                id: lb_step_x
                text: '0.0'
            Spinner:
                id: sp_x_points
                text: '5'
                values: '3', '5', '9', '15'
                on_text:
                    root.init()
            # row4
            Label:
                text: 'Y:'
                size_hint_x: 0.2
            Label:
                id: lb_min_y
                text: '0.0'
            Label:
                id: lb_max_y
                text: '0.0'
            Label:
                id: lb_step_y
                text: '0.0'
            Spinner:
                id: sp_y_points
                text: '5'
                values: '3', '5', '9', '15'
                on_text:
                    root.init()

        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    root.coord_popup.set_config('leveling', 'height', int(sp_height.text))
                    root.coord_popup.set_config('leveling', 'x_points', int(sp_x_points.text))
                    root.coord_popup.set_config('leveling', 'y_points', int(sp_y_points.text))
                    root.coord_popup.load_leveling_label()
                    if root.execute: app.root.execute_autolevel(int(sp_x_points.text), int(sp_y_points.text), False)
                    root.dismiss()

<UpgradePopup>:
    padding: '10dp'
    size_hint: 0.8, 0.8
    pos_hint: {"right": 0.9, "top": 0.9}
    auto_dismiss: False
    cbx_check_at_startup: cbx_check_at_startup
    check_button: check_button
    fw_upd_text: fw_upd_text
    ctl_upd_text: ctl_upd_text
    fw_version_txt: fw_version_txt
    ctl_version_txt: ctl_version_txt

    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            TransparentButton:
                icon: 'data/upgrade.png'
                halign: "left"
                valign: "middle"
            Label:
                text: tr._("Upgrade")
                bold: True
                halign: "left"
                valign: "middle"
                text_size: self.size
            Widget:
            MCQCheckBox:
                id: cbx_check_at_startup
            MCQLabel:
                on_press: cbx_check_at_startup._do_press()
                text: tr._(' Check Updates on Startup')
                size_hint_x: None
                width: '200dp'

        BoxLayout:
            padding: '5dp'
            spacing: '5dp'
            orientation: 'horizontal'
            TabbedPanel:
                do_default_tab: False
                # Create tab 1
                TabbedPanelItem:
                    canvas.after:
                        Color:
                            rgba: 52/255, 152/255, 219/255, 1
                        Ellipse:
                            pos: self.x + self.width - dp(13), self.y + self.height - dp(13)
                            size: dp(10) if app.ctl_has_update else 0, dp(10) if app.ctl_has_update else 0
                    text: tr._('Controller')
                    BoxLayout:
                        orientation: 'vertical'
                        BoxLayout:
                            size_hint_y: None
                            height: '40dp'
                            padding: '5dp'
                            Label:
                                size_hint_x: None
                                width: '100dp'
                                text: tr._(" Update Log:")
                                bold: True
                                halign: "left"
                                valign: "middle"
                                text_size: self.size
                                font_size: '12sp'
                            Label:
                            Label:
                                id: ctl_version_txt
                                size_hint_x: None
                                width: '350dp'
                                text: ''
                                color: (52/255, 152/255, 219/255, 1) if app.ctl_has_update else (250/255, 250/255, 250/255, 1)
                                bold: True
                                halign: "right"
                                valign: "middle"
                                text_size: self.size
                            Button:
                                size_hint_x: None
                                width: '100dp'
                                text: tr._("Download")
                                on_release:
                                    app.root.open_download()
                        TextInput:
                            id: ctl_upd_text
                            multiline: True
                            readonly: True
                            font_size: '13sp'
                            text: ""

                # Create 2nd tab
                TabbedPanelItem:
                    canvas.after:
                        Color:
                            rgba: 52/255, 152/255, 219/255, 1
                        Ellipse:
                            pos: self.x + self.width - dp(13), self.y + self.height - dp(13)
                            size: dp(10) if app.fw_has_update else 0, dp(10) if app.fw_has_update else 0
                    text: tr._('Firmware')
                    BoxLayout:
                        orientation: 'vertical'
                        BoxLayout:
                            size_hint_y: None
                            height: '40dp'
                            padding: '5dp'
                            Label:
                                size_hint_x: None
                                width: '100dp'
                                text: tr._(" Update Log:")
                                bold: True
                                halign: "left"
                                valign: "middle"
                                text_size: self.size
                                font_size: '12sp'
                            Label:
                            Label:
                                id: fw_version_txt
                                size_hint_x: None
                                width: '350dp'
                                text: ''
                                color: (52/255, 152/255, 219/255, 1) if app.fw_has_update else (250/255, 250/255, 250/255, 1)
                                bold: True
                                halign: "right"
                                valign: "middle"
                                text_size: self.size
                            Button:
                                size_hint_x: None
                                width: '100dp'
                                text: tr._("Download")
                                on_release:
                                    app.root.open_download()
                            Button:
                                size_hint_x: None
                                width: '100dp'
                                text: tr._("Update")
                                disabled:app.state != 'Idle'
                                on_release:
                                    app.root.file_popup.firmware_mode = True
                                    app.root.file_popup.popup_manager.transition.duration = 0
                                    app.root.file_popup.popup_manager.current = 'local_page'
                                    app.root.file_popup.open()
                                    app.root.file_popup.local_rv.child_dir('')
                        TextInput:
                            id: fw_upd_text
                            multiline: True
                            readonly: True
                            text: ''
                            font_size: '13sp'
                            focus: False

        BoxLayout:
            spacing: '5dp'
            padding: '5dp'
            size_hint_y: None
            height: '50dp'
            Button:
                id: check_button
                text: tr._("Check for Updates")
                on_release:
                    app.root.check_for_updates_post()
                    self.disabled = True
            Button:
                text: tr._('Close')
                on_release:
                    app.root.close_update_popup()


<FilePopup>:
    padding: '10dp'
    size_hint: 0.8, 0.8
    pos_hint: {"right": 0.9, "top": 0.9}
    auto_dismiss: False

    remote_rv: remote_rv
    local_rv: local_rv
    btn_open: btn_open
    btn_rename: btn_rename
    btn_select: btn_select
    btn_delete: btn_delete
    btn_upload: btn_upload
    btn_upload_Select:btn_upload_Select
    ti_local_search: ti_local_search
    ti_remote_search: ti_remote_search

    popup_manager: popup_manager
    PopupManager:
        id: popup_manager
        RemotePage:
            name: 'remote_page'
            BoxLayout:
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'
                    TransparentButton:
                        size_hint_x: None
                        width: '35dp'
                        icon: 'data/remote.png'
                        halign: "left"
                        valign: "middle"
                    Label:
                        size_hint_x: None
                        width: '80dp'
                        text: tr._("Remote")
                        bold: True
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    BoxLayout:
                        padding: '5dp'
                        size_hint_x: None
                        width: '200dp'
                        DirectoryView:
                            id: remote_directory_view
                            data_text: root.remote_rv.curr_dir_name
                            selected: True
                            on_release:
                                app.root.open_remote_dir_drop_down(self)
                    Label:
                    Button:
                        id: btn_rename
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("Rename")
                        disabled: True
                        on_release:
                            app.root.open_rename_input_popup()
                    Button:
                        id: btn_delete
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("Delete")
                        disabled: True
                        on_release:
                            app.root.open_del_confirm_popup()
                    Button:
                        id: btn_new_folder
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("New Folder")
                        disabled: app.state != 'Idle'
                        on_release:
                            app.root.open_newfolder_input_popup()
                    Button:
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("Upload File")
                        on_release:
                            root.firmware_mode = False
                            root.popup_manager.transition.direction = 'left'
                            root.popup_manager.transition.duration = 0.3
                            root.popup_manager.current = 'local_page'
                            root.local_rv.child_dir('')
                BoxLayout:
                    size_hint_y: None
                    height: '5dp'
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'
                    orientation: 'horizontal'
                    padding: '5dp'
                    canvas.before:
                        Color:
                            rgba: 56/255, 56/255, 56/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    ButtonLabel:
                        id: lb_remote_path1
                        text: root.remote_rv.curr_path_list[0] + ' ' if len(root.remote_rv.curr_path_list) > 0 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.remote_rv.goto_path(0)
                    ButtonLabel:
                        id: lb_remote_path2
                        width:
                        text: ' > ' + root.remote_rv.curr_path_list[1] + ' ' if len(root.remote_rv.curr_path_list) > 1 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.remote_rv.goto_path(1)
                    ButtonLabel:
                        id: lb_remote_path3
                        text: ' > ' + root.remote_rv.curr_path_list[2] + ' ' if len(root.remote_rv.curr_path_list) > 2 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        multiline: False
                        on_release:
                            root.remote_rv.goto_path(2)
                    ButtonLabel:
                        id: lb_remote_path4
                        text: ' > ' + root.remote_rv.curr_path_list[3] + ' ' if len(root.remote_rv.curr_path_list) > 3 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.remote_rv.goto_path(3)
                    ButtonLabel:
                        id: lb_remote_path5
                        text: ' > ' + root.remote_rv.curr_path_list[4] + ' ' if len(root.remote_rv.curr_path_list) > 4 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.remote_rv.goto_path(4)
                    ButtonLabel:
                        id: lb_remote_path6
                        text: ' > ' + root.remote_rv.curr_path_list[5] + ' ' if len(root.remote_rv.curr_path_list) > 5 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.remote_rv.goto_path(5)
                    Label:
                        id: lb_placeholder

                    RelativeLayout:
                        size_hint_x: None
                        width: '200dp'
                        padding: '2dp'
                        orientation: 'horizontal'
                        TransparentButton:
                            icon: 'data/search.png'
                            icon_size: 20
                            width: '25dp'
                        TextInput:
                            id: ti_remote_search
                            hint_text: tr._('Search')
                            disabled: app.state != 'Idle'
                            multiline: False
                            cursor_color: 1, 1, 1, 1
                            foreground_color: 1, 1, 1, 1
                            background_color: 80/255, 80/255, 80/255, 1
                            size_hint_x: None
                            width: '175dp'
                            pos: dp(25), self.y
                            on_text:
                                root.remote_rv.delay_search(self.text)
                        TransparentButton:
                            icon: 'data/delete.png' if len(root.ti_remote_search.text) > 0 else ''
                            icon_size: 20
                            width: '25dp'
                            pos: dp(175), self.y
                            on_release:
                                root.ti_remote_search.text = ''
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'
                    orientation: 'horizontal'
                    canvas.before:
                        Color:
                            rgba: 48/255, 48/255, 48/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    ButtonLabel:
                        text: tr._('Name ') + root.remote_rv.curr_sort_str[0]
                        text_size: self.size
                        bold: True
                        halign: 'left'
                        on_release:
                            root.remote_rv.fill_dir(sort_key = 'name', keyword = root.ti_remote_search.text)
                    ButtonLabel:
                        text: tr._('Date Modified ') + root.remote_rv.curr_sort_str[1]
                        text_size: self.size
                        bold: True
                        halign: 'left'
                        valign: 'middle'
                        size_hint_x: None
                        width: '150dp'
                        on_release:
                            root.remote_rv.fill_dir(sort_key = 'date', keyword = root.ti_remote_search.text)
                    ButtonLabel:
                        text: root.remote_rv.curr_sort_str[2] + tr._(' Size')
                        text_size: self.size
                        bold: True
                        halign: 'right'
                        valign: 'middle'
                        size_hint_x: None
                        width: '100dp'
                        on_release:
                            root.remote_rv.fill_dir(sort_key = 'size', keyword = root.ti_remote_search.text)
                RemoteRV:
                    id: remote_rv
                    root: root
                    app_root: app.root
                    scroll_type: ['bars', 'content']
                    scroll_wheel_distance: dp(114)
                    bar_width: dp(10)
                    viewclass: 'DataRow'
                    on_select: root.update_remote_buttons()
                    SelectableRecycleBoxLayout:
                        default_size: None, dp(40)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'
                        spacing: '0.5dp'
                        multiselect: False
                        touch_multiselect: False
                BoxLayout:
                    size_hint_y: None
                    height: '50dp'
                    spacing: '5dp'
                    padding: '5dp'
                    size_hint_y: None
                    Button:
                        text: tr._("Close")
                        on_release:
                            root.dismiss()
                    Button:
                        text: tr._("Clear Selection")
                        disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''
                        on_release:
                            app.selected_local_filename = ''
                            app.selected_remote_filename = ''
                            app.root.clear_selection()
                    Button:
                        id: btn_select
                        disabled: True
                        text: tr._("Select")
                        on_release:
                            app.root.check_and_download()
                            root.dismiss()

        LocalPage:
            name: 'local_page'
            BoxLayout:
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'
                    TransparentButton:
                        size_hint_x: None
                        width: '35dp'
                        icon: 'data/upgrade.png' if root.firmware_mode else 'data/local.png'
                        halign: "left"
                        valign: "middle"
                    Label:
                        size_hint_x: None
                        width: '80dp'
                        text: tr._("Firmware") if root.firmware_mode else tr._('Local')
                        bold: True
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    BoxLayout:
                        padding: '5dp'
                        size_hint_x: None
                        width: '200dp'
                        DirectoryView:
                            id: local_directory_view
                            data_text: root.local_rv.curr_dir_name
                            selected: True
                            on_release:
                                app.root.open_local_dir_drop_down(self)
                    Label:
                    Button:
                        id: btn_upload_Select
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("Upload&Select")
                        on_release:
                            app.root.check_and_upload_select()
                            root.dismiss()
                    Button:
                        id: btn_upload
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("Upload")
                        on_release:
                            app.root.check_and_upload()
                    Button:
                        id: btn_open
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("Download") if root.firmware_mode else tr._("Open")
                        on_release:
                            app.root.open_local_file()
                    Button:
                        size_hint_x: None
                        width: '100dp'
                        text: tr._("Close")
                        on_release:
                            if root.firmware_mode:\
                            root.dismiss()
                            else:\
                            root.load_remote_page()

                BoxLayout:
                    size_hint_y: None
                    height: '5dp'
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'
                    orientation: 'horizontal'
                    padding: '5dp'
                    canvas.before:
                        Color:
                            rgba: 56/255, 56/255, 56/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    ButtonLabel:
                        id: lb_local_path1
                        text: root.local_rv.curr_path_list[0] + ' ' if len(root.local_rv.curr_path_list) > 0 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.local_rv.goto_path(0)
                    ButtonLabel:
                        id: lb_local_path2
                        width:
                        text: ' > ' + root.local_rv.curr_path_list[1] + ' ' if len(root.local_rv.curr_path_list) > 1 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.local_rv.goto_path(1)
                    ButtonLabel:
                        id: lb_local_path3
                        text: ' > ' + root.local_rv.curr_path_list[2] + ' ' if len(root.local_rv.curr_path_list) > 2 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        multiline: False
                        on_release:
                            root.local_rv.goto_path(2)
                    ButtonLabel:
                        id: lb_local_path4
                        text: ' > ' + root.local_rv.curr_path_list[3] + ' ' if len(root.local_rv.curr_path_list) > 3 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.local_rv.goto_path(3)
                    ButtonLabel:
                        id: lb_local_path5
                        text: ' > ' + root.local_rv.curr_path_list[4] + ' ' if len(root.local_rv.curr_path_list) > 4 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.local_rv.goto_path(4)
                    ButtonLabel:
                        id: lb_local_path6
                        text: ' > ' + root.local_rv.curr_path_list[5] + ' ' if len(root.local_rv.curr_path_list) > 5 else ''
                        size_hint_x: None
                        size: self.texture_size
                        bold: True
                        on_release:
                            root.local_rv.goto_path(5)

                    Label:
                        id: lb_placeholder

                    RelativeLayout:
                        size_hint_x: None
                        width: '200dp'
                        padding: '2dp'
                        orientation: 'horizontal'
                        TransparentButton:
                            icon: 'data/search.png'
                            icon_size: 20
                            width: '25dp'
                        TextInput:
                            id: ti_local_search
                            hint_text: tr._('firmware') if root.firmware_mode else tr._('Search')
                            disabled: root.firmware_mode
                            multiline: False
                            cursor_color: 1, 1, 1, 1
                            foreground_color: 1, 1, 1, 1
                            background_color: 80/255, 80/255, 80/255, 1
                            size_hint_x: None
                            width: '175dp'
                            pos: dp(25), self.y
                            on_text:
                                root.local_rv.delay_search(self.text)
                        TransparentButton:
                            icon: 'data/delete.png' if len(root.ti_local_search.text) > 0 else ''
                            icon_size: 20
                            width: '25dp'
                            pos: dp(175), self.y
                            on_release:
                                root.ti_local_search.text = ''
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'
                    orientation: 'horizontal'
                    canvas.before:
                        Color:
                            rgba: 48/255, 48/255, 48/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    ButtonLabel:
                        text: tr._('Name ') + root.local_rv.curr_sort_str[0]
                        text_size: self.size
                        bold: True
                        halign: 'left'
                        on_release:
                            root.local_rv.fill_dir(sort_key = 'name', keyword = root.ti_local_search.text)
                    ButtonLabel:
                        text: tr._('Date Modified ') + root.local_rv.curr_sort_str[1]
                        text_size: self.size
                        bold: True
                        halign: 'left'
                        valign: 'middle'
                        size_hint_x: None
                        width: '150dp'
                        on_release:
                            root.local_rv.fill_dir(sort_key = 'date', keyword = root.ti_local_search.text)
                    ButtonLabel:
                        text: root.local_rv.curr_sort_str[2] + tr._(' Size')
                        text_size: self.size
                        bold: True
                        halign: 'right'
                        valign: 'middle'
                        size_hint_x: None
                        width: '100dp'
                        on_release:
                            root.local_rv.fill_dir(sort_key = 'size', keyword = root.ti_local_search.text)
                LocalRV:
                    id: local_rv
                    root: root
                    scroll_type: ['bars', 'content']
                    scroll_wheel_distance: dp(114)
                    bar_width: dp(10)
                    viewclass: 'DataRow'
                    on_select: root.update_local_buttons()
                    SelectableRecycleBoxLayout:
                        default_size: None, dp(40)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'
                        spacing: dp(0.5)
                        multiselect: False
                        touch_multiselect: False

<CoordPopup>:
    padding: '10dp'
    size_hint: 0.8, 0.9
    pos_hint: {"right": 0.9, "top": 0.9}
    auto_dismiss: False

    cnc_workspace: cnc_workspace
    lb_origin: lb_origin
    lb_zprobe: lb_zprobe
    lb_leveling: lb_leveling
    btn_origin: btn_origin
    btn_zprobe: btn_zprobe
    btn_leveling: btn_leveling
    cbx_margin: cbx_margin
    cbx_zprobe: cbx_zprobe
    cbx_leveling: cbx_leveling

    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            TransparentButton:
                icon: 'data/config_start.png'
                halign: "left"
                valign: "middle"
            Label:
                text: tr._("Config and Run") if root.mode == 'Run' else tr._(" Config and Do ") + root.mode
                bold: True
                halign: "left"
                valign: "middle"
                text_size: self.size

        BoxLayout:
            padding: '5dp'
            spacing: '5dp'
            orientation: 'horizontal'
            AnchorLayout:
                anchor_x: 'center'
                anchor_y: 'center'
                canvas:
                    Color:
                        rgba: 35/255, 35/255, 35/255, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                CNCWorkspace:
                    id: cnc_workspace
            BoxLayout:
                size_hint_x: None
                width: '200dp'
                orientation: 'vertical'

                BoxLayout:
                    padding: '1.0dp'
                    size_hint_y: None
                    opacity: 1 if app.model == 'C1' else 0
                    height: 0 if not app.model == 'C1' else '30dp'
                    Label:
                        text: tr._("Auto Vacuum")
                        halign: "left"
                        valign: "middle"
                        font_size: '13sp'
                        text_size: self.size

                        canvas.before:
                            Color:
                                rgba: 50/255, 50/255, 50/255, 1
                            Rectangle:
                                pos: self.pos
                                size: self.size
                    Switch:
                        id: vacuum_switch_play
                        canvas.before:
                            Color:
                                rgba: 50/255, 50/255, 50/255, 1
                            Rectangle:
                                pos: self.pos
                                size: self.size
                        active: True if root.vacuummode == 1 else False
                        disabled: not app.model == 'C1'
                        on_active:
                            app.root.update_control('vacuum_mode', self.active)

                BoxLayout:
                    padding: '1.0dp'
                    size_hint_y: None
                    opacity: 1 if app.model == 'C1' or app.model == 'CA1'else 0
                    height: 0 if not app.model == 'C1' and not app.model == 'CA1' else '30dp'
                    Label:
                        text: tr._("Auto ExtOut")
                        halign: "left"
                        valign: "middle"
                        font_size: '13sp'
                        text_size: self.size

                        canvas.before:
                            Color:
                                rgba: 50/255, 50/255, 50/255, 1
                            Rectangle:
                                pos: self.pos
                                size: self.size
                    Switch:
                        id: extout_switch_play
                        canvas.before:
                            Color:
                                rgba: 50/255, 50/255, 50/255, 1
                            Rectangle:
                                pos: self.pos
                                size: self.size
                        active: True if root.extoutmode == 1 else False
                        disabled: not app.model == 'C1' and not app.model == 'CA1'
                        on_active:
                            app.root.update_control('extout_mode', self.active)

                Label:
                    size_hint_y: None
                    height: '15dp'

                BoxLayout:
                    size_hint_y: None
                    height: '25dp'
                    canvas.before:
                        Color:
                            rgba: 65/255, 65/255, 65/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    Label:
                        text: tr._(" Set Work Origin")
                        halign: "left"
                        valign: "middle"
                        font_size: '13sp'
                        text_size: self.size
                    Widget:
                        size_hint_x: None
                        width: '25dp'
                        canvas.before:
                            Color:
                                rgba: 52/255, 152/255, 219/255, 1
                            Ellipse:
                                pos: self.center_x - dp(2.5), self.center_y - dp(5)
                                size: dp(10), dp(10)
                Label:
                    id: lb_origin
                    size_hint_y: None
                    height: '25dp'
                    text: tr._(" (0, 0) from Anchor1")
                    halign: "left"
                    valign: "middle"
                    font_size: '13sp'
                    text_size: self.size
                BoxLayout:
                    padding: '5dp', '0dp', '5dp', '10dp'
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Label:
                    Button:
                        id: btn_origin
                        text: tr._("Config")
                        font_size: '13sp'
                        on_release: root.origin_popup.open()

                BoxLayout:
                    size_hint_y: None
                    height: '25dp'
                    disabled:  (root.mode != 'Run' and root.mode != 'Margin') or app.lasering
                    canvas.before:
                        Color:
                            rgba: 65/255, 65/255, 65/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    MCQCheckBox:
                        id: cbx_margin
                        on_active:
                            root.set_config('margin', 'active', self.active)
                            root.toggle_config()
                    MCQLabel:
                        on_press: cbx_margin._do_press()
                        text: tr._(' Scan Margin')
                    Widget:
                        size_hint_x: None
                        width: '25dp'
                        canvas.before:
                            Color:
                                rgba: 0, 0.8, 0, 1
                            Ellipse:
                                pos: self.center_x - dp(2.5), self.center_y - dp(5)
                                size: dp(10), dp(10)
                Label:
                    size_hint_y: None
                    height: '15dp'

                BoxLayout:
                    size_hint_y: None
                    height: '25dp'
                    disabled:  (root.mode != 'Run' and root.mode != 'ZProbe') or root.cbx_leveling.active or app.lasering
                    canvas.before:
                        Color:
                            rgba: 65/255, 65/255, 65/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    MCQCheckBox:
                        id: cbx_zprobe
                        on_active:
                            root.lb_zprobe.disabled = not self.active or (root.mode != 'Run' and root.mode != 'ZProbe') or root.cbx_leveling.active
                            root.btn_zprobe.disabled = not self.active or app.has_4axis or (root.mode != 'Run' and root.mode != 'ZProbe') or root.cbx_leveling.active
                            root.set_config('zprobe', 'active', self.active)
                            root.toggle_config()
                    MCQLabel:
                        on_press: cbx_zprobe._do_press()
                        text: tr._(' Auto Z Probe')
                    Widget:
                        size_hint_x: None
                        width: '25dp'
                        canvas.before:
                            Color:
                                rgba: 231/255, 76/255, 60/255, 1
                            Ellipse:
                                pos: self.center_x - dp(2.5), self.center_y - dp(5)
                                size: dp(10), dp(10)
                Label:
                    id: lb_zprobe
                    size_hint_y: None
                    height: '25dp'
                    disabled:  (root.mode != 'Run' and root.mode != 'ZProbe') or root.cbx_leveling.active or app.lasering
                    text: tr._(" (10, 10) from Path Origin")
                    halign: "left"
                    valign: "middle"
                    font_size: '13sp'
                    text_size: self.size
                BoxLayout:
                    padding: '5dp', '0dp', '5dp', '10dp'
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Label:
                    Button:
                        id: btn_zprobe
                        text: tr._("Config")
                        font_size: '13sp'
                        disabled:  (root.mode != 'Run' and root.mode != 'ZProbe') or root.cbx_leveling.active or app.has_4axis
                        on_release: root.zprobe_popup.open()

                BoxLayout:
                    size_hint_y: None
                    height: '25dp'
                    disabled:  (root.mode != 'Run' and root.mode != 'Leveling') or app.has_4axis or app.lasering
                    canvas.before:
                        Color:
                            rgba: 65/255, 65/255, 65/255, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                    MCQCheckBox:
                        id: cbx_leveling
                        on_active:
                            root.lb_leveling.disabled = not self.active or app.has_4axis or (root.mode != 'Run' and root.mode != 'Leveling')
                            root.btn_leveling.disabled = not self.active or app.has_4axis or (root.mode != 'Run' and root.mode != 'Leveling')
                            root.set_config('leveling', 'active', self.active)
                            if self.active:\
                            root.cbx_zprobe.active = True;\
                            root.set_config('zprobe', 'active', True);\
                            root.set_config('zprobe', 'origin', 2);\
                            root.set_config('zprobe', 'x_offset', 0);\
                            root.set_config('zprobe', 'y_offset', 0);\
                            root.load_zprobe_label()
                            root.toggle_config()
                    MCQLabel:
                        on_press: cbx_leveling._do_press()
                        text: tr._(' Auto Leveling')
                    Widget:
                        size_hint_x: None
                        width: '25dp'
                        canvas.before:
                            Color:
                                rgba: 244/255, 208/255, 63/255, 1
                            Ellipse:
                                pos: self.center_x - dp(2.5), self.center_y - dp(5)
                                size: dp(10), dp(10)
                Label:
                    id: lb_leveling
                    size_hint_y: None
                    height: '25dp'
                    text: tr._(" X Points: 10, Y Points: 10, Height: 5")
                    disabled:  (root.mode != 'Run' and root.mode != 'Leveling') or app.has_4axis
                    halign: "left"
                    valign: "middle"
                    font_size: '13sp'
                    text_size: self.size
                BoxLayout:
                    padding: '5dp', '0dp', '5dp', '10dp'
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Label:
                    Button:
                        id: btn_leveling
                        text: tr._("Config")
                        font_size: '13sp'
                        disabled:  (root.mode != 'Run' and root.mode != 'Leveling') or app.has_4axis
                        on_release: root.auto_level_popup.init_and_open(False)

#                BoxLayout:
#                    size_hint_y: None
#                    height: '25dp'
#                    disabled: app.model != 'C1'
#                    canvas.before:
#                        Color:
#                            rgba: 65/255, 65/255, 65/255, 1
#                        Rectangle:
#                            pos: self.pos
#                            size: self.size
#                    MCQCheckBox:
#                        id: cbx_vacuum
#                        active: False
#                        on_active:
#                            #root.set_config('margin', 'active', self.active)
#                            #root.toggle_config()
#                            #app.root.update_control('vacuum_mode', self.active)
#                    MCQLabel:
#                        on_press: cbx_vacuum._do_press()
#                        text: tr._('Auto Vacuum')
#                    Widget:
#                        size_hint_x: None
#                        width: '25dp'
#                        canvas.before:
#                            Color:
#                                rgba: 255/255,255/255, 255/255, 1
#                            Ellipse:
#                                pos: self.center_x - dp(2.5), self.center_y - dp(5)
#                                size: dp(10), dp(10)


                Label:

        BoxLayout:
            spacing: '5dp'
            padding: '5dp'
            size_hint_y: None
            height: '50dp'
            Button:
                text: tr._("Close")
                on_release:
                    root.dismiss()
            Button:
                text: tr._('Run') if root.mode == 'Run' else tr._('Do ') + root.mode
                on_release:
                    root.dismiss()
                    if root.mode == 'Run': app.root.play(app.selected_remote_filename)
                    else: app.root.apply()

<SwitchBox@BoxLayout>:
    label: ''
    orientation: 'horizontal'
    switch: switch
    control_name: ''
    set_flag: False
    Switch:
        id: switch
        on_active:
            if root.set_flag: root.set_flag = False
            else: app.root.update_control(root.control_name, self.active)
    Label:
        text: root.label

<SliderBox@BoxLayout>:
    orientation: 'vertical'
    padding: dp(5), dp(5), dp(5), dp(5)
    min: 0
    max: 100
    step: 1
    slider: slider
    set_flag: False
    control_name: ''
    Widget:
    BoxLayout:
        size_hint_y: 1.5
        Slider:
            id: slider
            min: root.min
            max: root.max
            step: root.step
            on_value:
                if root.set_flag: root.set_flag = False
                else: app.root.update_control(root.control_name, self.value)
    BoxLayout:
        padding: dp(10), 0, dp(10), 0
        size_hint_y: 1.5
        Label:
            text_size: self.size
            halign: 'left'
            valign: 'middle'
            text: str(root.min)
        Label:
            text: str(int(root.slider.value))
        Label:
            text_size: self.size
            halign: 'right'
            valign: 'middle'
            text: str(root.max)
    Widget:

<StateBox@BoxLayout>:
    orientation: 'horizontal'
    state: False
    label: ''
    Widget:
        canvas.before:
            Color:
                rgba: (116/255, 247/255, 75/255, 1) if root.state else (80/255, 80/255, 80/255, 1)
            Rectangle:
                pos: self.x + self.width - dp(20), self.y + self.height / 2 - dp(8)
                size: dp(15), dp(15)
    Label:
        text: root.label
        text_size: self.size
        halign: 'left'
        valign: 'middle'

<DiagnosePopup>:
    padding: dp(10)
    size_hint: 0.8, 0.8
    pos_hint: {"right": 0.9, "top": 0.9}
    auto_dismiss: False

    # switch widget variables
    sw_spindle: sw_spindle
    sw_spindlefan: sw_spindlefan
    sw_vacuum: sw_vacuum
    sw_ExtOut: sw_ExtOut
    sw_laser: sw_laser
    sw_light: sw_light
    sw_tool_sensor_pwr: sw_tool_sensor_pwr
    sw_air: sw_air
    sw_wp_charge_pwr: sw_wp_charge_pwr

    # slider widget variables
    sl_spindle: sl_spindle
    sl_spindlefan: sl_spindlefan
    sl_vacuum: sl_vacuum
    sl_ExtOut:sl_ExtOut
    sl_laser: sl_laser

    # state widget variables
    st_x_min: st_x_min
    st_x_max: st_x_max
    st_y_min: st_y_min
    st_y_max: st_y_max
    st_z_max: st_z_max
    st_a_max: st_a_max
    st_atc_home: st_atc_home
    st_probe: st_probe
    st_calibrate: st_calibrate
    st_cover: st_cover
    st_tool_sensor: st_tool_sensor
    st_e_stop: st_e_stop
    st_rssi_txt:st_rssi_txt

    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            Label:
                text: tr._(" Diagnose ( Be careful, do not change except diagnosing )")
                bold: True
                halign: "left"
                valign: "middle"
                text_size: self.size
        BoxLayout:
            orientation: 'horizontal'
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 1.5
                SwitchBox:
                    id: sw_spindle
                    label: tr._('Spindle')
                    control_name: 'spindle_switch'
                SwitchBox:
                    id: sw_spindlefan
                    label: tr._('SpindleFan')
                    control_name: 'spindlefan_switch'
                SwitchBox:
                    id: sw_vacuum
                    label: tr._('Vacuum')
                    control_name: 'vacuum_switch'
                SwitchBox:
                    id: sw_ExtOut
                    label: tr._('Extend output')
                    control_name: 'Extend_switch'
                SwitchBox:
                    id: sw_laser
                    label: tr._('Laser')
                    control_name: 'laser_switch'
                SwitchBox:
                    id: sw_light
                    label: tr._('Light')
                    control_name: 'light_switch'
                SwitchBox:
                    id: sw_air
                    label: tr._('Air')
                    control_name: 'air_switch'
                    disabled: app.model != 'C1'
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 1.5
                SliderBox:
                    id: sl_spindle
                    max: 15000 if app.model == 'C1' else 12000
                    step: 100
                    control_name: 'spindle_slider'
                SliderBox:
                    id: sl_spindlefan
                    step: 5
                    control_name: 'spindlefan_slider'
                SliderBox:
                    id: sl_vacuum
                    step: 5
                    control_name: 'vacuum_slider'
                SliderBox:
                    id: sl_ExtOut
                    step: 5
                    control_name: 'ExtOut_slider'
                SliderBox:
                    id: sl_laser
                    step: 5
                    control_name: 'laser_slider'
                SwitchBox:
                    id: sw_tool_sensor_pwr
                    label: tr._('ToolSensorPWR') if app.model == 'C1' else tr._('Probe Laser')
                    control_name: 'tool_sensor_switch'
                SwitchBox:
                    id: sw_wp_charge_pwr
                    label: tr._('WPChargePWR') if app.model == 'C1' else tr._('Beep')
                    control_name: 'wp_charge_switch'
            BoxLayout:
                orientation: 'vertical'
                StateBox:
                    id: st_x_min
                    label: tr._('X- Limit')
                StateBox:
                    id: st_y_min
                    label: tr._('Y- Limit')
                StateBox:
                    id: st_atc_home
                    label: tr._('ATC Limit')
                    disabled: app.model != 'C1'
                StateBox:
                    id: st_probe
                    label: tr._('Probe')
                StateBox:
                    id: st_tool_sensor
                    label: tr._('Tool Sensor')
                    disabled: app.model != 'C1'
                StateBox:
                    id: st_e_stop
                    label: tr._('E-Stop')
            BoxLayout:
                orientation: 'vertical'
                StateBox:
                    id: st_x_max
                    label: tr._('X+ Limit')
                StateBox:
                    id: st_y_max
                    label: tr._('Y+ Limit')
                StateBox:
                    id: st_z_max
                    label: tr._('Z+ Limit')
                StateBox:
                    id: st_a_max
                    label: tr._('A+ Limit')
                StateBox:
                    id: st_calibrate
                    label: tr._('Calibrate')
                StateBox:
                    id: st_cover
                    label: tr._('Cover Switch')
                StateBox:
                    id: st_rssi_txt
                    label: tr._('RSSI')
                Label:
        BoxLayout:
            size_hint_y: None
            height: '50dp'
            spacing: '5dp'
            padding: '5dp'
            size_hint_y: None
            Button:
                text: tr._("Close")
                on_release:
                    root.dismiss()

<DiagnosePopupAir>:
    padding: dp(10)
    size_hint: 0.8, 0.8
    pos_hint: {"right": 0.9, "top": 0.9}
    auto_dismiss: False

    # switch widget variables
    sw_spindle: sw_spindle
    sw_spindlefan: sw_spindlefan
    sw_vacuum: sw_vacuum
    sw_laser: sw_laser
    sw_ExtOut: sw_ExtOut
    sw_light: sw_light
    sw_tool_sensor_pwr: sw_tool_sensor_pwr
    #sw_wp_charge_pwr: sw_wp_charge_pwr

    # slider widget variables
    sl_spindle: sl_spindle
    sl_spindlefan: sl_spindlefan
    sl_vacuum: sl_vacuum
    sl_laser: sl_laser
    sl_ExtOut:sl_ExtOut

    # state widget variables
    st_x_max: st_x_max
    st_y_max: st_y_max
    st_z_max: st_z_max
    st_a_max: st_a_max
    st_spindle_temp: st_spindle_temp
    st_power_temp: st_power_temp
    st_probe: st_probe
    st_calibrate: st_calibrate
    st_cover: st_cover
    st_e_stop: st_e_stop
    st_ExtInput:st_ExtInput
    st_rssi_txt:st_rssi_txt


    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            Label:
                text: tr._(" Diagnose ( Be careful, do not change except diagnosing )")
                bold: True
                halign: "left"
                valign: "middle"
                text_size: self.size
        BoxLayout:
            orientation: 'horizontal'
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 1.5
                SwitchBox:
                    id: sw_spindle
                    label: tr._('Spindle')
                    control_name: 'spindle_switch'
                SwitchBox:
                    id: sw_spindlefan
                    label: tr._('SpindleFan')
                    control_name: 'spindlefan_switch'
                SwitchBox:
                    id: sw_vacuum
                    label: tr._('PowerFan')
                    control_name: 'vacuum_switch'
                SwitchBox:
                    id: sw_laser
                    label: tr._('Laser')
                    control_name: 'laser_switch'
                SwitchBox:
                    id: sw_ExtOut
                    label: tr._('Extend output')
                    control_name: 'Extend_switch'
                SwitchBox:
                    id: sw_light
                    label: tr._('Light')
                    control_name: 'light_switch'
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 1.5
                SliderBox:
                    id: sl_spindle
                    max: 14000
                    step: 100
                    control_name: 'spindle_slider'
                SliderBox:
                    id: sl_spindlefan
                    step: 5
                    control_name: 'spindlefan_slider'
                SliderBox:
                    id: sl_vacuum
                    step: 5
                    control_name: 'vacuum_slider'
                SliderBox:
                    id: sl_laser
                    step: 5
                    control_name: 'laser_slider'
                SliderBox:
                    id: sl_ExtOut
                    step: 5
                    control_name: 'ExtOut_slider'
                SwitchBox:
                    id: sw_tool_sensor_pwr
                    label: tr._('Probe Laser')
                    control_name: 'tool_sensor_switch'
                #SwitchBox:
                #    id: sw_wp_charge_pwr
                #    label: tr._('Beep')
                #    control_name: 'wp_charge_switch'
            BoxLayout:
                orientation: 'vertical'
                StateBox:
                    id: st_e_stop
                    label: tr._('E-Stop')
                StateBox:
                    id: st_spindle_temp
                    label: tr._('Spindle Temp')
                StateBox:
                    id: st_power_temp
                    label: tr._('Power Temp')
                StateBox:
                    id: st_cover
                    label: tr._('Cover Switch')
                StateBox:
                    id: st_ExtInput
                    label: tr._('Extend Input')
                StateBox:
                    id: st_probe
                    label: tr._('Probe')
            BoxLayout:
                orientation: 'vertical'
                StateBox:
                    id: st_x_max
                    label: tr._('X+ Limit')
                StateBox:
                    id: st_y_max
                    label: tr._('Y+ Limit')
                StateBox:
                    id: st_z_max
                    label: tr._('Z+ Limit')
                StateBox:
                    id: st_a_max
                    label: tr._('A+ Limit')
                StateBox:
                    id: st_rssi_txt
                    label: tr._('RSSI')
                StateBox:
                    id: st_calibrate
                    label: tr._('Calibrate')
        BoxLayout:
            size_hint_y: None
            height: '50dp'
            spacing: '5dp'
            padding: '5dp'
            size_hint_y: None
            Button:
                text: tr._("Close")
                on_release:
                    root.dismiss()




<ConfigPopup>:
    padding: dp(10)
    size_hint: 0.8, 0.8
    pos_hint: {"right": 0.9, "top": 0.9}
    auto_dismiss: False
    settings_panel: settings_panel
    btn_apply: btn_apply
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            Label:
                text: tr._(" Settings")
                bold: True
                halign: "left"
                valign: "middle"
                text_size: self.size
            Button:
                id: btn_apply
                size_hint_x: None
                width: 200
                text: tr._("Apply")
                disabled: True
                on_release:
                    app.root.apply_setting_changes()
        BoxLayout:
            size_hint_y: None
            height: '5dp'
        MakeraConfigPanel:
            id: settings_panel
            on_close:
                root.dismiss()

<SplitterStrip>:
    background_down: 'data/splitter-strip.png'
    background_normal: 'data/splitter-strip.png'

<Makera>:
    gcode_rv: gcode_rv
    manual_rv: manual_rv
    manual_cmd: manual_cmd
    content: content
    status_data_view: status_data_view
    x_data_view: x_data_view
    y_data_view: y_data_view
    z_data_view: z_data_view
    a_data_view: a_data_view
    feed_data_view: feed_data_view
    spindle_data_view: spindle_data_view
    tool_data_view: tool_data_view
    laser_data_view: laser_data_view
    float_layout: float_layout
    step_a: step_a
    step_z: step_z
    step_xy: step_xy
    wpb_play: wpb_play
    wpb_margin: wpb_margin
    wpb_zprobe: wpb_zprobe
    wpb_leveling: wpb_leveling
    cmd_manager: cmd_manager
    gcode_viewer_container: gcode_viewer_container
    gcode_play_slider: gcode_play_slider

    BoxLayout:
        padding: dp(5)
        spacing: dp(5)
        orientation: 'vertical'

        canvas.before:
            Color:
                rgba: (30/255, 30/255, 30/255, 1)
            Rectangle:
                pos: self.pos
                size: self.size

        TopBar:
            padding: '3dp'
            spacing: '3dp'
            height: '50dp'
            size_hint_y: None
            orientation: 'horizontal'
            canvas.before:
                Color:
                    rgba: 100/255.0, 100/255.0, 100/255.0, 1
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            TopDataView:
                id: status_data_view
                color: 155/255, 155/255, 155/255, 1
                data_icon: 'data/status.png'
                main_text: "N/A"
                minr_text: tr._("disconnect")
                tooltip_text: tr._("Status and Connection")
                tooltip_position:'bottom'  # 在按钮下方显示
                on_release:
                    #if root.status_drop_down.parent: root.status_drop_down.parent.remove_widget(root.status_drop_down)
                    root.status_drop_down.open(self)
            Label:
                size_hint_x: None
                width: '3dp'

            TopDataView:
                id: x_data_view
                color: 231/255, 76/255, 60/255, 1
                data_text: 'X'
                main_text: "{:.3f}".format(1.0)
                minr_text: "{:.3f}".format(2.0)
                disabled: app.state == 'N/A'
                tooltip_text: tr._("X-axis working coordinate setting")
                tooltip_position:'bottom'  # 在按钮下方显示
                on_release: root.x_drop_down.open(self)

            TopDataView:
                id: y_data_view
                color: 34/255, 153/255, 84/255, 1
                data_text: 'Y'
                main_text: "{:.3f}".format(1.0)
                minr_text: "{:.3f}".format(2.0)
                disabled: app.state == 'N/A'
                tooltip_text: tr._("Y-axis working coordinate setting")
                tooltip_position:'bottom'  # 在按钮下方显示
                on_release: root.y_drop_down.open(self)

            TopDataView:
                id: z_data_view
                color: 52/255, 152/255, 219/255, 1
                data_text: 'Z'
                main_text: "{:.3f}".format(1.0)
                minr_text: "{:.3f}".format(2.0)
                disabled: app.state == 'N/A'
                tooltip_text: tr._("Z-axis working coordinate setting")
                tooltip_position:'bottom'  # 在按钮下方显示
                on_release: root.z_drop_down.open(self)

            TopDataView:
                id: a_data_view
                width: '98dp'
                color: 247/255, 220/255, 111/255, 1
                data_text: 'A'
                main_text: "{:.3f}".format(1.0)
                minr_text: "{:.3f}".format(2.0)
                disabled: app.state == 'N/A'
                tooltip_text: tr._("A-axis working coordinate setting")
                tooltip_position: 'bottom'  # 在按钮下方显示
                on_release: root.a_drop_down.open(self)

            Label:
                size_hint_x: None
                width: dp(0)

            TopDataView:
                id: feed_data_view
                data_icon: 'data/feed.png'
                main_text: "1000"
                minr_text: "100%"
                disabled: app.state == 'N/A'
                tooltip_text: tr._("Feed status and control")
                tooltip_position: 'bottom'  # 在按钮下方显示
                on_release:
                    root.feed_drop_down.open(self)
                    root.feed_drop_down.opened = True

            TopDataView:
                id: spindle_data_view
                data_icon: 'data/spindle.png'
                main_text: "10000"
                minr_text: "0.0 C"
                disabled: app.state == 'N/A'
                tooltip_text: tr._("Spindle status and control")
                tooltip_position: 'bottom'  # 在按钮下方显示
                on_release:
                    root.spindle_drop_down.open(self)
                    root.spindle_drop_down.opened = True

            TopDataView:
                id: tool_data_view
                data_icon: 'data/tool.png'
                main_text: "6"
                minr_text: "0.000"
                disabled: app.state == 'N/A'
                tooltip_text: tr._("Tool status and control")
                tooltip_position: 'bottom'  # 在按钮下方显示
                on_release:
                    root.tool_drop_down.open(self)
                    root.tool_drop_down.opened = True

            TopDataView:
                id: laser_data_view
                data_icon: 'data/laser.png'
                main_text: "10000"
                minr_text: "100%"
                disabled: app.state == 'N/A'
                tooltip_text: tr._("Laser status and control")
                tooltip_position: 'bottom'  # 在按钮下方显示
                on_release:
                    root.laser_drop_down.open(self)
                    root.laser_drop_down.opened = True

            Label:
                tmext: ''

            IconButton:
                icon: 'data/list.png'
                icon_size: 24
                notify: (app.fw_has_update or app.ctl_has_update) and app.state != 'N/A'
                tooltip_text: tr._("Other functions")
                tooltip_position: 'left'  # 在按钮左侧显示
                on_release:
                    root.func_drop_down.open(self)


        Content:
            id: content
            FilePage:
                name: 'File'
                BoxLayout:
                    orientation: 'vertical'
                    spacing: '5dp'
                    BoxLayout:
                        orientation: 'horizontal'
                        Splitter:
                            size_hint_x: 0.5
                            strip_size: '5dp'
                            sizable_from: 'right'
                            canvas.before:
                                Color:
                                    rgba: 0.6, 0.6, 0.6, 1  # Grey color for the strip
                                Rectangle:
                                    pos: self.x, self.y + self.height - self.strip_size
                                    size: self.width, self.strip_size
                            BoxLayout:
                                # size_hint_x: 0.5
                                orientation: 'vertical'
                                canvas.before:
                                    Color:
                                        rgba: 35/255.0, 35/255.0, 35/255.0, 1
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size

                                CMDManager:
                                    id: cmd_manager
                                    GCodeCMDPage:
                                        name: 'gcode_cmd_page'
                                        BoxLayout:
                                            spacing: '5dp'
                                            orientation: 'vertical'
                                            GCodeRV:
                                                id: gcode_rv
                                                scroll_type: ['bars', 'content']
                                                scroll_wheel_distance: dp(114)
                                                bar_width: dp(20)
                                                viewclass: 'Row'
                                                SelectableRecycleBoxLayout:
                                                    default_size: None, dp(20)
                                                    default_size_hint: 1, None
                                                    size_hint_y: None
                                                    height: self.minimum_height
                                                    orientation: 'vertical'
                                                    spacing: dp(0.5)
                                                    multiselect: False
                                                    touch_multiselect: False
                                            BoxLayout:
                                                orientation: 'horizontal'
                                                size_hint_y: None
                                                height: '33dp'
                                                Button:
                                                    id: toggle_mdi
                                                    width: '40dp'
                                                    size_hint_x: None
                                                    text: 'MDI'
                                                    on_release:
                                                        cmd_manager.transition.direction = 'left'
                                                        cmd_manager.current = 'manual_cmd_page'
                                                        manual_cmd.focus = True
                                                BoxLayout:
                                                    halign: 'center'
                                                    valign: 'middle'
                                                    Widget:
                                                    TransparentButton:
                                                        height: '0dp'
                                                        icon: 'data/to_start.png'
                                                        icon_size: 18
                                                        disabled: app.loading_page or app.curr_page == 1 or (app.state != 'Idle' and app.state != 'N/A')
                                                        on_release:
                                                            root.first_page()
                                                    TransparentButton:
                                                        height: '0dp'
                                                        icon: 'data/previous.png'
                                                        icon_size: 13
                                                        disabled: app.loading_page or app.curr_page == 1 or (app.state != 'Idle' and app.state != 'N/A')
                                                        on_release:
                                                            root.previous_page()
                                                    TransparentButton:
                                                        height: '0dp'
                                                        icon: 'data/start.png'
                                                        icon_size: 13
                                                        disabled: app.loading_page or app.curr_page == app.total_pages or (app.state != 'Idle' and app.state != 'N/A')
                                                        on_release:
                                                            root.next_page()
                                                    TransparentButton:
                                                        height: '0dp'
                                                        icon: 'data/to_end.png'
                                                        icon_size: 18
                                                        disabled: app.loading_page or app.curr_page == app.total_pages or (app.state != 'Idle' and app.state != 'N/A')
                                                        on_release:
                                                            root.last_page()

                                                    Widget:

                                    ManualCMDPage:
                                        name: 'manual_cmd_page'
                                        BoxLayout:
                                            orientation: 'vertical'
                                            spacing: '5dp'
                                            ManualRV:
                                                id: manual_rv
                                                scroll_type: ['bars', 'content']
                                                scroll_wheel_distance: dp(114)
                                                bar_width: dp(20)
                                                viewclass: 'Row'
                                                SelectableRecycleBoxLayout:
                                                    default_size: None, dp(20)
                                                    default_size_hint: 1, None
                                                    size_hint_y: None
                                                    height: self.minimum_height
                                                    orientation: 'vertical'
                                                    spacing: dp(0.5)
                                                    multiselect: False
                                                    touch_multiselect: False
                                            BoxLayout:
                                                orientation: 'horizontal'
                                                size_hint_y: None
                                                height: '33dp'
                                                Button:
                                                    id: toggle_file
                                                    width: '40dp'
                                                    size_hint_x: None
                                                    text: tr._('FILE')
                                                    on_release:
                                                        cmd_manager.transition.direction = 'right'
                                                        cmd_manager.current = 'gcode_cmd_page'
                                                TextInput:
                                                    id: manual_cmd
                                                    hint_text: tr._('Enter command...')
                                                    multiline: False
                                                    # disabled: app.state != 'Idle'
                                                    on_text_validate:
                                                        if app.state == 'Idle' or app.state == 'Pause' : root.send_cmd()
                                                Button:
                                                    id: send_cmd
                                                    width: '40dp'
                                                    size_hint_x: None
                                                    text: tr._('send')
                                                    disabled: app.state != 'Idle' and app.state != 'Pause'
                                                    on_release:
                                                        root.send_cmd()

                        FloatBox:
                            id: float_layout
                            tool_bar: tool_bar
                            t1: t1
                            t2: t2
                            t3: t3
                            t4: t4
                            t5: t5
                            t6: t6
                            t7: t7
                            t8: t8
                            laser: laser
                            hide_all: hide_all
                            gcode_ctl_bar: gcode_ctl_bar
                            BoxLayout:
                                id: gcode_viewer_container
                                pos: float_layout.pos
                                orientation: 'vertical'
                            BoxLayout:
                                id: tool_bar
                                orbit: True
                                size_hint_x: 1
                                size_hint_y: 0.1 if app.show_gcode_ctl_bar else 0
                                opacity: 1 if app.show_gcode_ctl_bar else 0
                                # pos: float_layout.x, 0
                                pos_hint: {'x': 0.0, 'top': 1.0}
                                canvas.before:
                                    Color:
                                        rgba: 10/255, 10/255, 10/255, 0.2
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size
                                BoxLayout:
                                    # tool bar buttons
                                    TransparentButton:
                                        width: '50dp'
                                        active: tool_bar.orbit
                                        icon: 'data/orbit.png'
                                        disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''
                                        on_release:
                                            tool_bar.orbit = True
                                            root.gcode_viewer.set_orbit(True)
                                    TransparentButton:
                                        width: '50dp'
                                        active: not tool_bar.orbit
                                        icon: 'data/pan.png'
                                        disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''
                                        on_release:
                                            tool_bar.orbit = False
                                            root.gcode_viewer.set_orbit(False)
                                    TransparentButton:
                                        width: '50dp'
                                        icon: 'data/zoom_out.png'
                                        disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''
                                        on_release:
                                            root.gcode_viewer.zoom_in()
                                    TransparentButton:
                                        width: '50dp'
                                        icon: 'data/zoom_in.png'
                                        disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''
                                        on_release:
                                            root.gcode_viewer.zoom_out()
                                    TransparentButton:
                                        width: '50dp'
                                        icon: 'data/zoom_fit.png'
                                        disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''
                                        on_release:
                                            root.gcode_viewer.restore_default_view()
                                    Widget:

                                    # tools
                                    TransparentButton:
                                        id: t1
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T1'
                                        active: app.tool == 1
                                        disabled: 1 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: t2
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T2'
                                        active: app.tool == 2
                                        disabled: 2 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: t3
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T3'
                                        active: app.tool == 3
                                        disabled: 3 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: t4
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T4'
                                        active: app.tool == 4
                                        disabled: 4 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: t5
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T5'
                                        active: app.tool == 5
                                        disabled: 5 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: t6
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T6'
                                        active: app.tool == 6
                                        disabled: 6 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: t7
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T7'
                                        active: app.tool == 7
                                        disabled: 7 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: t8
                                        width: '44dp'
                                        valign: 'middle'
                                        text: 'T8'
                                        active: app.tool == 8
                                        disabled: 8 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentButton:
                                        id: laser
                                        width: '44dp'
                                        valign: 'middle'
                                        icon: 'data/laser.png'
                                        active: app.lasering == True
                                        disabled: 7 not in root.used_tools
                                        min_icon: 'data/eye.png'
                                        on_release:
                                            self.min_active = not self.min_active
                                            app.root.filter_tool()
                                    TransparentGrayButton:
                                        id: hide_all
                                        width: '50dp'
                                        icon: 'data/eye.png'
                                        disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''
                                        on_release:
                                            self.active = not self.active
                                            if self.active:\
                                            t1.min_active = True;\
                                            t2.min_active = True;\
                                            t3.min_active = True;\
                                            t4.min_active = True;\
                                            t5.min_active = True;\
                                            t6.min_active = True;\
                                            t7.min_active = True;\
                                            t8.min_active = True;\
                                            laser.min_active = True;
                                            else:\
                                            t1.min_active = False;\
                                            t2.min_active = False;\
                                            t3.min_active = False;\
                                            t4.min_active = False;\
                                            t5.min_active = False;\
                                            t6.min_active = False;\
                                            t7.min_active = False;\
                                            t8.min_active = False;\
                                            laser.min_active = False;
                                            app.root.filter_tool()
                            BoxLayout:
                                id: gcode_ctl_bar
                                size_hint_x: 1
                                size_hint_y: 0.2 if app.show_gcode_ctl_bar else 0
                                opacity: 1 if app.show_gcode_ctl_bar else 0
                                orientation: 'vertical'
                                pos: float_layout.pos
                                canvas.before:
                                    Color:
                                        rgba: 10/255, 10/255, 10/255, 0.2
                                    Rectangle:
                                        pos: self.pos
                                        size: self.size
                                BoxLayout:
                                    Widget:
                                    TransparentButton:
                                        height: '0dp'
                                        icon: 'data/to_start.png'
                                        icon_size: 24
                                        disabled: (app.selected_remote_filename == '' and app.selected_local_filename == '') or (app.state != 'Idle' and app.state != 'N/A')
                                        on_release:
                                            root.gcode_play_to_start()
                                    TransparentButton:
                                        icon: 'data/backward.png'
                                        icon_size: 24
                                        disabled: (app.selected_remote_filename == '' and app.selected_local_filename == '') or (app.state != 'Idle' and app.state != 'N/A')
                                        on_release:
                                            root.gcode_play_speed_down()
                                    TransparentButton:
                                        icon: 'data/suspend.png' if root.gcode_playing else 'data/start.png'
                                        icon_size: 26 if root.gcode_playing else 18
                                        disabled: (app.selected_remote_filename == '' and app.selected_local_filename == '') or (app.state != 'Idle' and app.state != 'N/A')
                                        on_release:
                                            root.gcode_play_toggle()
                                    TransparentButton:
                                        icon: 'data/forward.png'
                                        icon_size: 24
                                        disabled: (app.selected_remote_filename == '' and app.selected_local_filename == '') or (app.state != 'Idle' and app.state != 'N/A')
                                        on_release:
                                            root.gcode_play_speed_up()
                                    TransparentButton:
                                        icon: 'data/to_end.png'
                                        icon_size: 24
                                        disabled: (app.selected_remote_filename == '' and app.selected_local_filename == '') or (app.state != 'Idle' and app.state != 'N/A')
                                        on_release:
                                            root.gcode_play_to_end()

                                    Widget:
                                GcodePlaySlider:
                                    id: gcode_play_slider
                                    height: '15dp'
                                    min: 0
                                    max: 1000
                                    value: 1000
                                    disabled: app.selected_remote_filename == '' and app.selected_local_filename == ''

            ControlPage:
                name: 'Control'
                BoxLayout:
                    orientation: 'vertical'
                    Widget:
                        size_hint_y: 0.2
                    BoxLayout:
                        orientation: 'horizontal'
                        padding: '10dp'
                        canvas.before:
                            Color:
                                rgba: 40/255, 40/255, 40/255, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [self.height / 2,]
                        BoxLayout:
                            disabled: (app.state != 'Idle' and app.state != 'Run' and app.state != 'Pause') or (app.playing and app.state != 'Pause')
                            padding: '25dp'
                            canvas.before:
                                Color:
                                    rgba: 50/255, 50/255, 50/255, 1
                                Ellipse:
                                    pos: self.pos
                                    size: self.size
                            GridLayout:
                                cols: 3
                                rows: 3
                                GridBoxLayout:
                                GridBoxLayout:
                                    RoundButton:
                                        text: 'Y-'
                                        on_release: root.controller.jog("Y-", root.step_xy.text)
                                GridBoxLayout:
                                GridBoxLayout:
                                    RoundButton:
                                        text: 'X-'
                                        on_release: root.controller.jog("X-", root.step_xy.text)
                                GridBoxLayout:
                                    Label:
                                    Spinner:
                                        id: step_xy
                                        center: 0.5, 0.5
                                        size_hint_y: None
                                        height: '40dp'
                                        text: '10'
                                        values: '10', '1', '0.1', '0.01', '0.005'
                                    Label:

                                GridBoxLayout:
                                    RoundButton:
                                        text: 'X+'
                                        on_release: root.controller.jog("X", root.step_xy.text)
                                GridBoxLayout:
                                GridBoxLayout:
                                    RoundButton:
                                        text: 'Y+'
                                        on_release: root.controller.jog("Y", root.step_xy.text)
                                GridBoxLayout:
                        BoxLayout:
                            disabled: app.state != 'Idle'
                            orientation: 'vertical'
                            padding: '10dp'
                            Widget:
                                size_hint_y: 0.5
                            BoxLayout:
                                padding: '10dp'
                                canvas.before:
                                    Color:
                                        rgba: 50/255, 50/255, 50/255, 1
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [dp(12),]
                                GridLayout:
                                    cols: 3
                                    rows: 3
                                    GridBoxLayout:
                                        Label:
                                        SmallRoundButton:
                                            text: tr._('Unlock')
                                            on_release:
                                                app.root.controller.unlock()
                                        Label:
                                    GridBoxLayout:
                                        Label:
                                        SmallRoundButton:
                                            text: tr._('Reset')
                                            on_release: root.controller.reset()
                                        Label:
                                    GridBoxLayout:
                                        Label:
                                        SmallRoundButton:
                                            text: tr._('Home')
                                            on_release: root.controller.home()
                                        Label:
                                    GridBoxLayout:
                                        Label:
                                        SmallRoundButton:
                                            disabled: app.state != 'Idle' or app.selected_remote_filename == ''
                                            text: tr._('Margin...')
                                            on_release:
                                                root.coord_popup.mode = 'Margin'
                                                root.coord_popup.set_config('margin', 'active', True)
                                                root.coord_popup.set_config('zprobe', 'active', False)
                                                root.coord_popup.set_config('leveling', 'active', False)
                                                root.coord_popup.load_config()
                                                root.coord_popup.open()
                                        Label:
                                    GridBoxLayout:
                                        Label:
                                        Spinner:
                                            center: 0.5, 0.5
                                            size_hint_y: None
                                            height: '35dp'
                                            disabled: app.state != 'Idle'
                                            text: tr._('Probe...')
                                            values: tr._('ZProbe...'), tr._('3D Probe...')
                                            on_text:
                                                if self.text == tr._("ZProbe...") and app.selected_remote_filename != '':\
                                                root.coord_popup.mode = 'ZProbe';\
                                                root.coord_popup.set_config('margin', 'active', False);\
                                                root.coord_popup.set_config('zprobe', 'active', True);\
                                                root.coord_popup.set_config('leveling', 'active', False);\
                                                root.coord_popup.load_config();\
                                                root.coord_popup.open()
                                                if self.text == tr._("ZProbe...") and app.selected_remote_filename == '':\
                                                root.load_error(tr._('Please first Select and Open the remote file that needs to be processed.'))
                                                if self.text == tr._("3D Probe..."):\
                                                root.D3Probe_Popup.open()
                                                if self.text != tr._("Probe..."): self.text = tr._('Probe...')
                                        Label:
                                    GridBoxLayout:
                                        Label:
                                        SmallRoundButton:
                                            disabled: app.state != 'Idle' or app.selected_remote_filename == '' or app.has_4axis
                                            text: tr._('AutoLevel...')
                                            on_release:
                                                root.coord_popup.mode = 'Leveling'
                                                root.coord_popup.set_config('margin', 'active', False)
                                                root.coord_popup.set_config('zprobe', 'active', False)
                                                root.coord_popup.set_config('leveling', 'active', True)
                                                root.coord_popup.load_config()
                                                root.coord_popup.open()

                                        Label:
                                    GridBoxLayout:
                                        Label:
                                        Spinner:
                                            center: 0.5, 0.5
                                            size_hint_y: None
                                            height: '35dp'
                                            text: tr._('Goto...')
                                            values: tr._('Clearance'), tr._('Work Origin'), tr._('Path Origin'), tr._('Anchor1'), tr._('Anchor2')
                                            on_text:
                                                if self.text != tr._("Goto..."): app.root.controller.gotoPosition(self.text)
                                                if self.text != tr._("Goto..."): self.text = tr._('Goto...')
                                        Label:
                                    GridBoxLayout:
                                        Label:
                                        SmallRoundButton:
                                            text: tr._('Set Origin')
                                            on_release: root.coord_popup.origin_popup.open()
                                        Label:
                            Widget:
                                size_hint_y: 0.5
                        BoxLayout:
                            disabled: (app.state != 'Idle' and app.state != 'Run' and app.state != 'Pause') or (app.playing and app.state != 'Pause')
                            padding: '25dp'
                            orientation: 'horizontal'
                            canvas.before:
                                Color:
                                    rgba: 50/255, 50/255, 50/255, 1
                                Ellipse:
                                    pos: self.pos
                                    size: self.size
                            Widget:
                                size_hint_x: 0.2
                            GridLayout:
                                cols: 2
                                rows: 3
                                GridBoxLayout:
                                    RoundButton:
                                        text: 'A+'
                                        on_release: root.controller.jog("A", root.step_a.text, True)
                                GridBoxLayout:
                                    RoundButton:
                                        text: 'Z+'
                                        on_release: root.controller.jog("Z", root.step_z.text)
                                GridBoxLayout:
                                    Label:
                                    Spinner:
                                        id: step_a
                                        center: 0.5, 0.5
                                        size_hint_y: None
                                        height: '40dp'
                                        text: '90'
                                        values: '90', '10', '1', '0.1'
                                    Label:
                                GridBoxLayout:
                                    Label:
                                    Spinner:
                                        id: step_z
                                        center: 0.5, 0.5
                                        size_hint_y: None
                                        height: '40dp'
                                        text: '1'
                                        values: '10', '1', '0.1', '0.01', '0.005'
                                    Label:
                                GridBoxLayout:
                                    RoundButton:
                                        text: 'A-'
                                        on_release: root.controller.jog("A-", root.step_a.text, True)
                                GridBoxLayout:
                                    RoundButton:
                                        text: 'Z-'
                                        on_release: root.controller.jog("Z-", root.step_z.text)

                            Widget:
                                size_hint_x: 0.2
                    Widget:
                        size_hint_y: 0.2
            SettingPage:
                name: 'Setting'
                Label:
                    text: tr._('SettingPage')
        BottomBar:
            height: '50dp'
            size_hint_y: None
            orientation: 'horizontal'
            canvas.before:
                Color:
                    rgba: 100/255.0, 100/255.0, 100/255.0, 1
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height
            BoxLayout:
                padding: '3dp'
                spacing: '2dp'
                orientation: 'horizontal'
                canvas:
                    Color:
                        rgba: 30/255, 30/255, 30/255, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                IconButton:
                    icon: 'data/file.png'
                    icon_size: 21
                    disabled: app.state != 'Idle' and app.state != 'N/A' and not app.playing
                    tooltip_text: tr._("Open the G-Code file ready for play")
                    tooltip_position: 'top'  # 在按钮上方显示
                    on_release:
                        root.file_popup.firmware_mode = False
                        root.file_popup.popup_manager.transition.duration = 0
                        root.file_popup.popup_manager.current = 'remote_page'
                        root.file_popup.open()
                        if app.state == 'Idle':\
                        root.file_popup.load_remote_root()
                Label:
                    size_hint_x: None
                    width: '3dp'
                IconButton:
                    icon: 'data/start.png' if app.state == 'Pause' else 'data/config_start.png'
                    icon_size: 25
                    disabled: (app.state != 'Idle' or app.selected_remote_filename == '' or app.playing) and app.state != 'Pause'
                    tooltip_text: tr._("Start running G-Code task")
                    tooltip_position: 'top'  # 在按钮上方显示
                    on_release:
                        if app.state == 'Pause':\
                        app.root.resume_conform_popup()
                        else:\
                        root.coord_popup.mode = 'Run';\
                        root.coord_popup.load_config();\
                        root.coord_popup.open()
                IconButton:
                    icon: 'data/suspend.png'
                    disabled: app.state != 'Run' or not app.playing
                    tooltip_text: tr._("Pause the running G-Code task")
                    tooltip_position: 'top'  # 在按钮上方显示
                    on_release:
                        app.root.controller.suspendCommand()
                IconButton:
                    icon: 'data/abort.png'
                    icon_size: 24
                    disabled: (app.state != 'Run' and app.state != 'Pause') or not app.playing
                    tooltip_text: tr._("Terminate the current G-Code task")
                    tooltip_position: 'top'  # 在按钮下方显示
                    on_release:
                        app.root.controller.abortCommand()
                Label:
                    size_hint_x: None
                    width: '3dp'
                IconButton:
                    icon: 'data/feedhold2.png' if app.state == 'Hold' else 'data/feedhold1.png'
                    icon_size: 24
                    disabled: app.state != 'Run' and app.state != 'Idle' and app.state != 'Hold'
                    tooltip_text: tr._("Hold the current G-Code task")
                    tooltip_position: 'top'  # 在按钮上方显示
                    on_release:
                        self.disabled = True
                        app.root.controller.toggleFeedholdCommand(app.state == 'Hold')
                Label:
                    size_hint_x: None
                    width: '3dp'
                BoxLayout:
                    padding: 0, 0, 0, dp(0.5)
                    WideProgressBar:
                        id: wpb_margin
                        size_hint_x: None
                        width: '25dp'
                        color: 0, 0.8, 0, 1
                    WideProgressBar:
                        id: wpb_zprobe
                        size_hint_x: None
                        width: '25dp'
                        color: 231/255, 76/255, 60/255, 1
                    WideProgressBar:
                        id: wpb_leveling
                        size_hint_x: None
                        width: '25dp'
                        color: 244/255, 208/255, 63/255, 1
                    WideProgressBar:
                        id: wpb_play
                        Label:
                            size_hint_x: None
                            width: '5dp'
                        Label:
                            text: root.progress_info
                            text_size: self.size
                            halign: 'left'
                            valign: 'middle'
                            font_size: '16sp'
                            color: 240/255, 240/255, 240/255, 1

                IconButton:
                    icon: 'data/stop.png'
                    icon_size: 40
                    disabled: app.state == 'N/A'
                    tooltip_text: tr._("Emergency stop the current G-Code task")
                    tooltip_position: 'top'  # 在按钮下方显示
                    on_release:
                        app.root.controller.estopCommand()

    Button:
        size_hint: None, None
        size: '40dp', '100dp'
        pos: root.width - self.width, (root.height - self.height) / 2
        text: '<' if root.content.current == 'File' else '>'
        background_color: 80/255, 80/255, 80/255, 1
        on_release:
            if app.root.content.current == 'File':\
            app.root.content.transition.direction = 'left';\
            app.root.content.current = 'Control'
            else:\
            app.root.content.transition.direction = 'right';\
            app.root.content.current = 'File'

<SetXPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    txt_offset: txt_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Set X Current Pos')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            padding: '15dp'
            orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: 'Value:'
                halign: "left"
                valign: "center"
                text_size: self.size
            TextInput:
                id: txt_offset
                hint_text: tr._('Enter X Pos')
                multiline: False
                text: '0.0'
                halign: "left"
                input_type: 'number'
                input_filter: 'float'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    app.root.controller.wcsSet(float(txt_offset.text or '0'), None, None, None)
                    root.dismiss()

<SetYPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    txt_offset: txt_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Set Y Current Pos')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            padding: '15dp'
            orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: 'Value:'
                halign: "left"
                valign: "center"
                text_size: self.size
            TextInput:
                id: txt_offset
                hint_text: tr._('Enter Y Pos')
                multiline: False
                text: '0.0'
                halign: "left"
                input_type: 'number'
                input_filter: 'float'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    app.root.controller.wcsSet(None, float(txt_offset.text or '0'), None, None)
                    root.dismiss()

<SetZPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    txt_offset: txt_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Set Z Current Pos')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            padding: '15dp'
            orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: 'Value:'
                halign: "left"
                valign: "center"
                text_size: self.size
            TextInput:
                id: txt_offset
                hint_text: tr._('Enter Z Pos')
                multiline: False
                text: '0.0'
                halign: "left"
                input_type: 'number'
                input_filter: 'float'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    app.root.controller.wcsSet(None, None, float(txt_offset.text or '0'), None)
                    root.dismiss()

<SetAPopup>:
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    txt_offset: txt_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Set A Current Pos')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            padding: '15dp'
            orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: 'Value:'
                halign: "left"
                valign: "center"
                text_size: self.size
            TextInput:
                id: txt_offset
                hint_text: tr._('Enter A Pos')
                multiline: False
                text: '0.0'
                halign: "left"
                input_type: 'number'
                input_filter: 'float'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    app.root.controller.wcsSet(None, None, None, float(txt_offset.text or '0'))
                    root.dismiss()

<MoveAPopup>
    size_hint: 0.5, 0.4
    pos_hint: {"right": 0.75, "top": 0.7}
    auto_dismiss: False
    txt_offset: txt_offset
    BoxLayout:
        padding: '15dp'
        orientation: 'vertical'
        Label:
            canvas.before:
                Color:
                    rgba: 45/255, 45/255, 45/255, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            id: caption
            size_hint_y: None
            height: '30dp'
            text: tr._('Rapidly move the A to')
            halign: 'left'
            valign: 'middle'
        BoxLayout:
            padding: '15dp'
            orientation: 'vertical'
        BoxLayout:
            size_hint_y: None
            height: '30dp'
            Label:
                text: 'Value:'
                halign: "left"
                valign: "center"
                text_size: self.size
            TextInput:
                id: txt_offset
                hint_text: tr._('Enter A Pos')
                multiline: False
                text: '0.0'
                halign: "left"
                input_type: 'number'
                input_filter: 'float'
        BoxLayout:
            id: empty
        BoxLayout:
            spacing: '5dp'
            size_hint_y: None
            height: '40dp'
            Button:
                id: btn_cancel
                text: tr._('Cancel')
                on_release: root.dismiss()
            Button:
                id: btn_ok
                text: tr._('Ok')
                on_release:
                    app.root.controller.RapMoveA(float(txt_offset.text or '0'))
                    root.dismiss()

<D3ProbePopup>:
    size_hint: 0.75, 0.75
    pos_hint: {"right": 0.9, "top": 0.9}
    auto_dismiss: False
    cbx_top_left: cbx_top_left
    cbx_top_right: cbx_top_right
    cbx_bottom_left: cbx_bottom_left
    cbx_bottom_right: cbx_bottom_right
    cbx_in_top_left: cbx_in_top_left
    cbx_in_top_right: cbx_in_top_right
    cbx_in_bottom_left: cbx_in_bottom_left
    cbx_in_bottom_right: cbx_in_bottom_right
    cbx_bore_pocket:cbx_bore_pocket
    cbx_bore_pocket_x:cbx_bore_pocket_x
    cbx_bore_pocket_y:cbx_bore_pocket_y
    cbx_boss_block:cbx_boss_block
    cbx_boss_block_x:cbx_boss_block_x
    cbx_boss_block_y:cbx_boss_block_y
    current_corner: 'bottom_left'  # 设置默认值
    in_current_corner: 'bottom_left'  # 设置默认值
    center_pick: 'bore_pocket'
    image_paths: {'top_left': 'data/out_top_left.png','top_right': 'data/out_top_right.png','bottom_right': 'data/out_bottom_right.png','bottom_left': 'data/out_bottom_left.png'}
    image_paths2: {'top_left': 'data/in_top_left.png','top_right': 'data/in_top_right.png','bottom_right': 'data/in_bottom_right.png','bottom_left': 'data/in_bottom_left.png'}
    image_paths3: {'bore_pocket': 'data/bore_pocket.png','bore_pocket_x': 'data/bore_pocket_x.png','bore_pocket_y': 'data/bore_pocket_y.png','boss_block': 'data/boss_block.png','boss_block_x': 'data/boss_block_x.png','boss_block_y': 'data/boss_block_y.png'}
    TabbedPanel:
        do_default_tab: False
        tab_width: root.width / 3 - dp(2)
        TabbedPanelItem:
            text: tr._('Outside Corner picking')
            BoxLayout:
                padding: '15dp'
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'

                    MCQCheckBox:
                        id: cbx_bottom_left
                        group: 'outsidecorner'
                        active: True
                        on_active:root.current_corner = 'bottom_left'
                    MCQLabel:
                        on_press: cbx_bottom_left._do_press(); root.current_corner = 'bottom_left'
                        text: tr._('bottom-left corner')
                    MCQCheckBox:
                        id: cbx_top_left
                        group: 'outsidecorner'
                        on_active:root.current_corner = 'top_left'
                    MCQLabel:
                        on_press: cbx_top_left._do_press(); root.current_corner = 'top_left'
                        text: tr._('top-left corner')
                    MCQCheckBox:
                        id: cbx_top_right
                        group: 'outsidecorner'
                        on_active:root.current_corner = 'top_right'
                    MCQLabel:
                        on_press: cbx_top_right._do_press(); root.current_corner = 'top_right'
                        text: tr._('top-right corner')
                    MCQCheckBox:
                        id: cbx_bottom_right
                        group: 'outsidecorner'
                        on_active:root.current_corner = 'bottom_right'
                    MCQLabel:
                        on_press: cbx_bottom_right._do_press(); root.current_corner = 'bottom_right'
                        text: tr._('bottom-right corner')
                    # Label:

                BoxLayout:
                    size_hint_y: 1.0
                    padding: '10dp'
                    # 图片显示组件（初始隐藏）
                    Image:
                        id: corner_image
                        source: root.image_paths.get(root.current_corner, 'data/icon.png')
                        allow_stretch: True
                        keep_ratio: True
                        opacity: 1

                BoxLayout:
                    size_hint_y: None
                    height: '30dp'
                    Label:
                        text: tr._('X Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_x_offset
                        hint_text: tr._('Enter X Offset')
                        multiline: False
                        text: '20'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)
                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Y Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_y_offset
                        hint_text: tr._('Enter Y Offset')
                        multiline: False
                        text: '20'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)

                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Z Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_z_offset
                        hint_text: tr._('Enter Z Offset')
                        multiline: False
                        text: '2'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)

                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Probe Dia:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_d_offset
                        hint_text: tr._('Enter Probe Dia')
                        multiline: False
                        text: '2'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)
                BoxLayout:
                    id: empty
                    size_hint_y: None
                    height: '60dp'
                    Label:
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        text: tr._('Z Offset: Probe tip-to-surface distance during edge probing.') + '\n' + tr._('Note: Please make sure the 3D Probe is stably positioned.')
                        color: 52/255, 152/255, 219/255, 1

                BoxLayout:
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Button:
                        id: btn_cancel
                        text: tr._('Cancel')
                        on_release: root.dismiss()
                    Button:
                        id: btn_ok
                        text: tr._('Ok')
                        on_release:
                            app.root.ProbeOutsideCorner(root.selected_outcorner(), float(txt_x_offset.text or '0'), float(txt_y_offset.text or '0'), float(txt_z_offset.text or '0'), float(txt_d_offset.text or '0') )
                            root.dismiss()

        TabbedPanelItem:
            text: tr._('Inside Corner picking')
            BoxLayout:
                padding: '15dp'
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'

                    MCQCheckBox:
                        id: cbx_in_bottom_left
                        group: 'insidecorner'
                        active: True
                        on_active:root.in_current_corner = 'bottom_left'
                    MCQLabel:
                        on_press: cbx_in_bottom_left._do_press(); root.in_current_corner = 'bottom_left'
                        text: tr._('bottom-left corner')
                    MCQCheckBox:
                        id: cbx_in_top_left
                        group: 'insidecorner'
                        on_active:root.in_current_corner = 'top_left'
                    MCQLabel:
                        on_press: cbx_in_top_left._do_press(); root.in_current_corner = 'top_left'
                        text: tr._('top-left corner')
                    MCQCheckBox:
                        id: cbx_in_top_right
                        group: 'insidecorner'
                        on_active:root.in_current_corner = 'top_right'
                    MCQLabel:
                        on_press: cbx_in_top_right._do_press(); root.in_current_corner = 'top_right'
                        text: tr._('top-right corner')
                    MCQCheckBox:
                        id: cbx_in_bottom_right
                        group: 'insidecorner'
                        on_active:root.in_current_corner = 'bottom_right'
                    MCQLabel:
                        on_press: cbx_in_bottom_right._do_press(); root.in_current_corner = 'bottom_right'
                        text: tr._('bottom-right corner')
                    # Label:

                BoxLayout:
                    size_hint_y: 1.0
                    padding: '10dp'
                    # 图片显示组件（初始隐藏）
                    Image:
                        id: in_corner_image
                        source: root.image_paths2.get(root.in_current_corner, 'data/icon.png')
                        allow_stretch: True
                        keep_ratio: True
                        opacity: 1

                BoxLayout:
                    size_hint_y: None
                    height: '30dp'
                    Label:
                        text: tr._('X Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_in_x_offset
                        hint_text: tr._('Enter X Offset')
                        multiline: False
                        text: '20'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)
                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Y Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_in_y_offset
                        hint_text: tr._('Enter Y Offset')
                        multiline: False
                        text: '20'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)

                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Z Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_in_z_offset
                        hint_text: tr._('Enter Z Offset')
                        multiline: False
                        text: '2'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)

                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Probe Dia:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_in_d_offset
                        hint_text: tr._('Enter Probe Dia')
                        multiline: False
                        text: '2'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)
                BoxLayout:
                    id: empty
                    size_hint_y: None
                    height: '60dp'
                    Label:
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        text: tr._('Z Offset: Probe tip-to-surface distance during edge probing.') + '\n' + tr._('Note: Please make sure the 3D Probe is stably positioned.')
                        color: 52/255, 152/255, 219/255, 1

                BoxLayout:
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Button:
                        text: tr._('Cancel')
                        on_release: root.dismiss()
                    Button:
                        text: tr._('Ok')
                        on_release:
                            app.root.ProbeInsideCorner(root.selected_incorner(), float(txt_in_x_offset.text or '0'), float(txt_in_y_offset.text or '0'), float(txt_in_z_offset.text or '0'), float(txt_in_d_offset.text or '0') )
                            root.dismiss()

        TabbedPanelItem:
            text: tr._('Center picking')
            BoxLayout:
                padding: '15dp'
                orientation: 'vertical'
                BoxLayout:
                    size_hint_y: None
                    height: '40dp'

                    MCQCheckBox:
                        id: cbx_bore_pocket
                        group: 'center_pick'
                        active: True
                        on_active:root.center_pick = 'bore_pocket'
                    MCQLabel:
                        on_press: cbx_bore_pocket._do_press(); root.center_pick = 'bore_pocket'
                        text: tr._('Bore/Pocket')
                    MCQCheckBox:
                        id: cbx_bore_pocket_x
                        group: 'center_pick'
                        active: True
                        on_active:root.center_pick = 'bore_pocket_x'
                    MCQLabel:
                        on_press: cbx_bore_pocket_x._do_press(); root.center_pick = 'bore_pocket_x'
                        text: tr._('Bore/Pocket-X')
                    MCQCheckBox:
                        id: cbx_bore_pocket_y
                        group: 'center_pick'
                        active: True
                        on_active:root.center_pick = 'bore_pocket_y'
                    MCQLabel:
                        on_press: cbx_bore_pocket_y._do_press(); root.center_pick = 'bore_pocket_y'
                        text: tr._('Bore/Pocket-Y')


                    MCQCheckBox:
                        id: cbx_boss_block
                        group: 'center_pick'
                        on_active:root.center_pick = 'boss_block'
                    MCQLabel:
                        on_press: cbx_boss_block._do_press(); root.center_pick = 'boss_block'
                        text: tr._('Boss/Block')
                    MCQCheckBox:
                        id: cbx_boss_block_x
                        group: 'center_pick'
                        on_active:root.center_pick = 'boss_block_x'
                    MCQLabel:
                        on_press: cbx_boss_block_x._do_press(); root.center_pick = 'boss_block_x'
                        text: tr._('Boss/Block-X')
                    MCQCheckBox:
                        id: cbx_boss_block_y
                        group: 'center_pick'
                        on_active:root.center_pick = 'boss_block_y'
                    MCQLabel:
                        on_press: cbx_boss_block_y._do_press(); root.center_pick = 'boss_block_y'
                        text: tr._('Boss/Block-Y')
                    # Label:

                BoxLayout:
                    size_hint_y: 1.0
                    padding: '10dp'
                    # 图片显示组件（初始隐藏）
                    Image:
                        id: in_center_image
                        source: root.image_paths3.get(root.center_pick, 'data/icon.png')
                        allow_stretch: True
                        keep_ratio: True
                        opacity: 1

                BoxLayout:
                    size_hint_y: None
                    height: '30dp'
                    Label:
                        text: tr._('X Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        opacity: 1 if not any([root.cbx_bore_pocket_y.active,root.cbx_boss_block_y.active]) else 0  # 条件控制透明度
                    TextInput:
                        id: txt_center_x_offset
                        hint_text: tr._('Enter X Offset')
                        multiline: False
                        text: '20'
                        input_type: 'number'
                        input_filter: 'float'
                        opacity: 1 if not any([root.cbx_bore_pocket_y.active,root.cbx_boss_block_y.active]) else 0  # 条件控制透明度
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)
                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Y Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        opacity: 1 if not any([root.cbx_bore_pocket_x.active,root.cbx_boss_block_x.active]) else 0  # 条件控制透明度
                    TextInput:
                        id: txt_center_y_offset
                        hint_text: tr._('Enter Y Offset')
                        multiline: False
                        text: '20'
                        input_type: 'number'
                        input_filter: 'float'
                        opacity: 1 if not any([root.cbx_bore_pocket_x.active,root.cbx_boss_block_x.active]) else 0  # 条件控制透明度
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)

                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Z Offset:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        opacity: 1 if any([root.cbx_boss_block.active,root.cbx_boss_block_x.active,root.cbx_boss_block_y.active]) else 0  # 条件控制透明度
                    TextInput:
                        id: txt_center_z_offset
                        hint_text: tr._('Enter Z Offset')
                        multiline: False
                        opacity: 1 if any([root.cbx_boss_block.active,root.cbx_boss_block_x.active,root.cbx_boss_block_y.active]) else 0  # 条件控制透明度
                        text: '2'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)

                    Label:
                        size_hint_x: 0.3
                    Label:
                        text: tr._('Probe Dia:')
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                    TextInput:
                        id: txt_center_d_offset
                        hint_text: tr._('Enter Probe Dia')
                        multiline: False
                        text: '2'
                        input_type: 'number'
                        input_filter: 'float'
                        on_text:
                            self.background_color = (0.5, 0, 0, 1) if self.text.strip() == "" else (1, 1, 1, 1)
                BoxLayout:
                    id: empty
                    size_hint_y: None
                    height: '60dp'
                    Label:
                        halign: "left"
                        valign: "middle"
                        text_size: self.size
                        text:
                            tr._('Z Offset: Probe tip-to-surface distance during edge probing.') + '\n' + tr._('Note: Please make sure the 3D Probe is stably positioned.')  if root.cbx_boss_block.active else \
                            tr._('Note1:First, move the 3D probe inside the Bore/Pocket, ensuring the bottom of the probe is lower than the top surface of the Bore/Pocket.') + '\n' + tr._('Note2: Please make sure the 3D Probe is stably positioned.')
                        color: 52/255, 152/255, 219/255, 1

                BoxLayout:
                    spacing: '5dp'
                    size_hint_y: None
                    height: '40dp'
                    Button:
                        text: tr._('Cancel')
                        on_release: root.dismiss()
                    Button:
                        text: tr._('Ok')
                        on_release:
                            app.root.ProbeCenter(root.selected_center(), float(txt_center_x_offset.text or '0'), float(txt_center_y_offset.text or '0'), float(txt_center_z_offset.text or '0'), float(txt_center_d_offset.text or '0') )
                            root.dismiss()